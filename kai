versi = " | MULTIUSER | V5.1.4" -- fix auto fav selected item
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local player = Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui")
local character = player.Character or player.CharacterAdded:Wait()
local root = character:WaitForChild("HumanoidRootPart")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Net =
    ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild(
    "net"
)
local ItemUtility = require(ReplicatedStorage.Shared.ItemUtility)
local HttpService = game:GetService("HttpService")
local dailyLoginGui = gui:FindFirstChild("!!! Daily Login")
local koin = gui:WaitForChild("Events").Frame.CurrencyCounter.Counter.Text
local humanoid = character:WaitForChild("Humanoid")
local animator = humanoid:WaitForChild("Animator")

local ok, Replion =
    pcall(
    function()
        return require(ReplicatedStorage.Packages.Replion)
    end
)
if not ok or not Replion.Client then
    warn("Replion client tidak ditemukan")
    return
end
local PLATFORM_SIZE = Vector3.new(6, 0.2, 6)
local OFFSET = -3
--//ANCHOR GLOBAL VARIABLE
local startscript = tick()
local running = true
local list_inventory_rod = {}
local list_inventory_bait = {}
local list_inventory_fishs = {}
local fish_caught = false
local count_mancing = 0
local step = 0
local total_stone = 0
local progress_quest1 = 0
local progress_quest2 = 0
local progress_quest3 = 0
local progress_quest4 = 0
local list_secret = {}
local list_mythic = {}
local list_display = {}
local list_trade_batu = {}
local list_inv_item_uuid = {}
local list_fav = {}
local playing = true
local global_event = false
local stop_global_control = false
local current_bait = "None"

local web_enable = false
local web_location =""
local web_old_location = ""

local SERVER_URL = "https://hayfishit.dpdns.org/update"
local CONFIG_URL = "https://hayfishit.dpdns.org/config/search"
local USER_LIST = "https://hayfishit.dpdns.org/user?nama="

local total_harga_secret = 0
local total_harga_mythic = 0

local placeId = game.PlaceId
local jobId = game.JobId

local select_quest = "none"
local master_user = "hayfish96"
local master_user2 = "haycollector"
local current_rod = ""
local current_rod_enchant = nil
local lastCatchTime = nil
local list_sibling = {}

--khusus event unlocker
local flag_item_unlocker = true
local list_item_unlocker = {263, 270, 284, 283}
local count_custom_inv_id = 0
-- === ScreenGui utama ===
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "HAYBOT"
screenGui.Parent = gui

--//ANCHOR gui
-- === Frame utama (container) ===
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(1, 0, 1, 100)
mainFrame.Position = UDim2.new(0, 0, 0, -100)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BorderSizePixel = 0
mainFrame.BackgroundTransparency = 1
mainFrame.Visible = true
mainFrame.Parent = screenGui

local text_jam = Instance.new("TextLabel")
text_jam.Size =  UDim2.new(1, 0, 0.1, 0)
text_jam.Position = UDim2.new(0, 0, 0.2, 0)
text_jam.Text = "00:00:00"
text_jam.Font = Enum.Font.RobotoMono
text_jam.TextScaled = true
text_jam.BackgroundTransparency = 1
text_jam.TextXAlignment = Enum.TextXAlignment.Center
text_jam.TextColor3 = Color3.fromRGB(230, 255, 1)
text_jam.Parent = mainFrame

local text_rod = Instance.new("TextLabel")
text_rod.Size =  UDim2.new(0.5, 0, 0.1, 0)
text_rod.Position = UDim2.new(0, 0, 0.35, 0)
text_rod.Text = "RiD"
text_rod.Font = Enum.Font.RobotoMono
text_rod.TextScaled = true
text_rod.BackgroundTransparency = 1
text_rod.TextXAlignment = Enum.TextXAlignment.Center
text_rod.TextColor3 = Color3.fromRGB(123, 72, 218)
text_rod.Parent = mainFrame

local text_rod_enchant = Instance.new("TextLabel")
text_rod_enchant.Size =  UDim2.new(0.5, 0, 0.05, 0)
text_rod_enchant.Position = UDim2.new(0, 0, 0.35, 80)
text_rod_enchant.Text = "enchant"
text_rod_enchant.Font = Enum.Font.RobotoMono
text_rod_enchant.TextScaled = true
text_rod_enchant.BackgroundTransparency = 1
text_rod_enchant.TextXAlignment = Enum.TextXAlignment.Center
text_rod_enchant.TextColor3 = Color3.fromRGB(85, 145, 255)
text_rod_enchant.Parent = mainFrame

local text_rod_speed = Instance.new("TextLabel")
text_rod_speed.Size =  UDim2.new(0.5, 0, 0.05, 0)
text_rod_speed.Position = UDim2.new(0, 0, 0.35, 130)
text_rod_speed.Text = "speed: "
text_rod_speed.Font = Enum.Font.RobotoMono
text_rod_speed.TextScaled = true
text_rod_speed.BackgroundTransparency = 1
text_rod_speed.TextXAlignment = Enum.TextXAlignment.Center
text_rod_speed.TextColor3 = Color3.fromRGB(238, 157, 7)
text_rod_speed.Parent = mainFrame

local text_bait = Instance.new("TextLabel")
text_bait.Size =  UDim2.new(0.5, 0, 0.1, 0)
text_bait.Position = UDim2.new(0.5, 0, 0.35, 0)
text_bait.Text = "BAIT"
text_bait.Font = Enum.Font.RobotoMono
text_bait.TextScaled = true
text_bait.BackgroundTransparency = 1
text_bait.TextXAlignment = Enum.TextXAlignment.Center
text_bait.TextColor3 = Color3.fromRGB(21, 151, 49)
text_bait.Parent = mainFrame

local text_info = Instance.new("TextLabel")
text_info.Size = UDim2.new(1, 50, 0.15, 0)
text_info.Position = UDim2.new(0, 0, 0.65, 0)
text_info.Text = "activity"
text_info.Font = Enum.Font.Roboto
text_info.TextScaled = true
text_info.BackgroundTransparency = 1
text_info.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
text_info.TextXAlignment = Enum.TextXAlignment.Center
text_info.TextColor3 = Color3.fromRGB(255, 255, 255)
text_info.Parent = mainFrame

local text_progress = Instance.new("TextLabel")
text_progress.Size = UDim2.new(1, 50, 0.1, 0)
text_progress.Position = UDim2.new(0, 0, 0.8, 0)
text_progress.Text = "progress.."
text_progress.Font = Enum.Font.Roboto
text_progress.TextScaled = true
text_progress.BackgroundTransparency = 1
text_progress.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
text_progress.TextXAlignment = Enum.TextXAlignment.Center
text_progress.TextColor3 = Color3.fromRGB(255, 255, 255)
text_progress.Parent = mainFrame

local text_versi = Instance.new("TextLabel")
text_versi.Size = UDim2.new(0, 0, 0, 0)
text_versi.Position = UDim2.new(0.5, 0, 0, 110)
text_versi.Text = "HAYBOT " .. versi
text_versi.Font = Enum.Font.RobotoMono
text_versi.TextSize = 28
text_versi.TextXAlignment = Enum.TextXAlignment.Center
text_versi.TextColor3 = Color3.fromRGB(255, 255, 255)
text_versi.Parent = mainFrame

local text_timer = Instance.new("TextLabel")
text_timer.Size = UDim2.new(1, 0, 0.1, 0)
text_timer.Position = UDim2.new(0, 0, 0.5, 0)
text_timer.Text = "üü¢"
text_timer.BackgroundTransparency = 1
text_timer.Font = Enum.Font.RobotoMono
text_timer.TextScaled = true
text_timer.TextXAlignment = Enum.TextXAlignment.Center
text_timer.TextColor3 = Color3.fromRGB(230, 255, 1)
text_timer.Parent = mainFrame

local text_online = Instance.new("TextLabel")
text_online.Size = UDim2.new(1, 0, 0.05, 0)
text_online.Position = UDim2.new(0, 0, 0.4, 40)
text_online.Text = ""
text_online.BackgroundTransparency = 1
text_online.Font = Enum.Font.RobotoMono
text_online.TextScaled = true
text_online.TextXAlignment = Enum.TextXAlignment.Center
text_online.TextColor3 = Color3.fromRGB(230, 255, 1)
text_online.Parent = mainFrame

local text_nama = Instance.new("TextLabel")
text_nama.Size = UDim2.new(0, 0, 0, 0)
text_nama.Position = UDim2.new(0.5, 0, 0.1, 0)
text_nama.Text = player.Name
text_nama.Font = Enum.Font.RobotoMono
text_nama.TextSize = 50
text_nama.TextXAlignment = Enum.TextXAlignment.Center
text_nama.TextColor3 = Color3.fromRGB(255, 255, 255)
text_nama.Parent = mainFrame

local btn_reload = Instance.new("TextButton")
btn_reload.Size = UDim2.new(0, 40, 0, 40)
btn_reload.Position = UDim2.new(0, 180, 0, 130)
btn_reload.Text = "üîÑ"
btn_reload.TextScaled = true
btn_reload.Visible = true
btn_reload.TextXAlignment = Enum.TextXAlignment.Center
btn_reload.TextColor3 = Color3.fromRGB(255, 255, 255)
btn_reload.Parent = mainFrame
btn_reload.BackgroundColor3 = Color3.fromRGB(77, 77, 77)

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 40, 0, 40)
closeBtn.Position = UDim2.new(0, 100, 0, 130)
closeBtn.Text = "‚ùå"
closeBtn.TextScaled = true
closeBtn.Visible = true
closeBtn.TextXAlignment = Enum.TextXAlignment.Center
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Parent = mainFrame

local btn_stop = Instance.new("TextButton")
btn_stop.Size = UDim2.new(0, 40, 0, 40)
btn_stop.Position = UDim2.new(0, 140, 0, 130)
btn_stop.Text = "‚õî"
btn_stop.TextScaled = true
btn_stop.Visible = true
btn_stop.TextXAlignment = Enum.TextXAlignment.Center
btn_stop.TextColor3 = Color3.fromRGB(255, 255, 255)
btn_stop.BackgroundColor3 = Color3.fromRGB(77, 77, 77)
btn_stop.Parent = mainFrame

local render_btn = Instance.new("TextButton")
render_btn.Size = UDim2.new(0, 40, 0, 40)
render_btn.Position = UDim2.new(0, 220, 0, 130)
render_btn.Text = "üëÅÔ∏è"
render_btn.Visible = true
render_btn.TextScaled = true
render_btn.TextXAlignment = Enum.TextXAlignment.Center
render_btn.TextColor3 = Color3.fromRGB(255, 255, 255)
render_btn.Parent = mainFrame

-- Buat tombol utama (dropdown)
local dropdownButton = Instance.new("TextButton")
dropdownButton.Size = UDim2.new(0, 80, 0, 40)
dropdownButton.Position = UDim2.new(0, 20, 0, 130)
dropdownButton.BackgroundColor3 = Color3.fromRGB(141, 61, 161)
dropdownButton.TextColor3 = Color3.new(1, 1, 1)
dropdownButton.Font = Enum.Font.Roboto
dropdownButton.TextScaled = true
dropdownButton.Text = "MENU ‚ñº"
dropdownButton.Parent = mainFrame

-- Frame isi dropdown
local dropdownFrame = Instance.new("Frame")
dropdownFrame.Size = UDim2.new(0, 200, 0, 0)
dropdownFrame.Position = UDim2.new(0, 20, 0, 180)
dropdownFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
dropdownFrame.BorderSizePixel = 1
dropdownFrame.Visible = false
dropdownFrame.ClipsDescendants = true
dropdownFrame.Parent = mainFrame

local last_msg = "-"
local function pesan(msg)
    last_msg = msg
    text_info.Text = msg
    print(msg)
end

--// ANCHOR OPTION MENU
local options = {
                "Trade Secret","Trade Mythic", "Trade Stone", "-", "TEST", "Listen Trade",
                "Auto Buy", "Merchant", "Jobs ID", "STOP CONTROL", "teleport custom", "Farm Event",
                "Enhant I", "E (empowered 10%)", "E (mutation +30%)", "E (cursed 75%)", "E (prismatic -8)", "Enchant II"
            }

local function opsia(x)
    opsi(x)
end -- Buat tombol untuk setiap opsi
-- pengaturan layout
local maxPerColumn = 6
local optionHeight = 40
local columnWidth = 200

-- hitung total kolom
local numColumns = math.ceil(#options / maxPerColumn)
dropdownFrame.Size = UDim2.new(0, columnWidth * numColumns, 0, 0)

for i, text in ipairs(options) do
    local column = math.floor((i - 1) / maxPerColumn)
    local row = (i - 1) % maxPerColumn

    local option = Instance.new("TextButton")
    option.Size = UDim2.new(0, columnWidth, 0, optionHeight)
    option.Position = UDim2.new(0, column * columnWidth, 0, row * optionHeight)
    option.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    option.TextColor3 = Color3.new(1, 1, 1)
    option.Font = Enum.Font.Roboto
    option.TextScaled = true
    option.Text = text
    option.Parent = dropdownFrame

    -- Hover efek
    option.MouseEnter:Connect(function()
        option.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    end)
    option.MouseLeave:Connect(function()
        option.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    end)

    -- Klik opsi
    option.MouseButton1Click:Connect(function()
        dropdownButton.Text = text .. " ‚ñº"
        dropdownFrame:TweenSize(UDim2.new(0, columnWidth * numColumns, 0, 0), "Out", "Sine", 0.2, true)
        task.delay(0.2, function()
            dropdownFrame.Visible = false
        end)
        opsia(i)
    end)
end

-- Fungsi toggle dropdown
dropdownButton.MouseButton1Click:Connect(function()
    if dropdownFrame.Visible then
        dropdownFrame:TweenSize(UDim2.new(0, columnWidth * numColumns, 0, 0), "Out", "Sine", 0.2, true)
        task.delay(0.2, function()
            dropdownFrame.Visible = false
        end)
    else
        dropdownFrame.Visible = true
        local totalHeight = math.min(#options, maxPerColumn) * optionHeight
        dropdownFrame:TweenSize(UDim2.new(0, columnWidth * numColumns, 0, totalHeight), "Out", "Sine", 0.2, true)
    end
end)
----------------------------------------------------------------------------------
------------------- MAIN FUNGSI
----------------------------------------------------------------------------------
local function playAnimation(id)
    local anim = Instance.new("Animation")
    anim.AnimationId = id
    local track = animator:LoadAnimation(anim)
    track:Play()
    return track
end
local function dump_table(t, indent)
    indent = indent or 0
    local formatting = string.rep("  ", indent)

    if type(t) ~= "table" then
        print(formatting .. tostring(t))
        return
    end

    for k, v in pairs(t) do
        if type(v) == "table" then
            print(formatting .. tostring(k) .. " = {")
            dump_table(v, indent + 1)
            print(formatting .. "}")
        else
            print(formatting .. tostring(k) .. " = " .. tostring(v))
        end
    end
end

local function getOnlineTime()
    local elapsed = tick() - startscript
    return elapsed
end

local function formatTime(seconds)
    local h = math.floor(seconds / 3600)
    local m = math.floor((seconds % 3600) / 60)
    local s = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", h, m, s)
end

local function rejoinSameServer()
    if not player then
        return
    end
    -- pcall supaya aman jika error
    local ok, err =
        pcall(
        function()
            TeleportService:TeleportToPlaceInstance(placeId, jobId, player)
        end
    )
    if not ok then
        warn("Rejoin gagal: " .. tostring(err))
    end
end

local function cek_quest(text)
    print(text)
    if not text then
        return 0
    end
    local percent = string.match(text, "(%d+)%%")
    if percent then
        return tonumber(percent)
    end
    return 0
end

local function convert(str)
    if string.find(str, "K") then
        local num = string.gsub(str, "K", "")
        return math.floor(num * 1000)
    end
    if string.find(str, "M") then
        local num = string.gsub(str, "M", "")
        return math.floor(num * 1000000)
    end
    return tonumber(str)
end

function round(num, numDecimalPlaces)
    local mult = 10 ^ (numDecimalPlaces or 0)
    return math.floor(num * mult + 0.5) / mult
end

local function fav(uuid)
    Net:WaitForChild("RE/FavoriteItem"):FireServer(uuid)
    task.wait(1)
end

local function auto_buy_rod(id)
    print("beli rod id:", id)
    Net:WaitForChild("RF/PurchaseFishingRod"):InvokeServer(id)
end
local function wear_bait(id)
    Net:WaitForChild("RE/EquipBait"):FireServer(id)
end
local function auto_buy_bait(id)
    print("beli bait id:", id)
    Net:WaitForChild("RF/PurchaseBait"):InvokeServer(id)
end

local function konvert_harga(h)
    if h < 999 then
        result = tostring(h)
    elseif h < 1000000 then
        kk = h / 1000
        result = tostring(round(kk, 2)) .. " K"
    else
        kk = h / 1000000
        result = tostring(round(kk, 2)) .. " M"
    end
    return result
end

local list_ikan = {}
local list_rod = {}
for _, child in pairs(ReplicatedStorage:WaitForChild("Items"):GetChildren()) do
    if child:IsA("ModuleScript") then
        local success, data = pcall(require, child)
        if success and data.Data.Type == "Fish" then
            list_ikan[data.Data.Id] = {
                type = data.Data.Type,
                harga = data.SellPrice,
                tier = data.Data.Tier,
                nama = data.Data.Name,
                id = data.Data.Id
            }
        end
        if success and string.find(data.Data.Name, "Rod") then
            list_rod[data.Data.Id] = {
                tier = data.Data.Tier,
                nama = data.Data.Name,
                id = data.Data.Id
            }
        end
    end
end
local Enchants = ReplicatedStorage:WaitForChild("Enchants")

-- Fungsi untuk mendapatkan info enchant dari Id
local function info_enchant(id)
	for _, module in ipairs(Enchants:GetChildren()) do
		if module:IsA("ModuleScript") then
			local success, data = pcall(require, module)
			if success and type(data) == "table" and data.Data and data.Data.Id == id then
				return data -- mengembalikan seluruh isi module (Data + Modifiers)
			end
		end
	end
	return nil -- kalau tidak ditemukan
end
-----------------------------------------------------------------
--              JSON ONLINE DECODER
-----------------------------------------------------------------

local function getJSON(url)
    local response =
        request(
        {
            Url = url,
            Method = "GET",
            Headers = {
                ["Accept"] = "application/json"
            }
        }
    )

    if not response.Success then
        warn("Request gagal:", response.StatusCode)
        return nil
    end

    local ok, data =
        pcall(
        function()
            return HttpService:JSONDecode(response.Body)
        end
    )

    if ok then
        return data
    else
        warn("Gagal decode JSON:", data)
        return nil
    end
end

--//ANCHOR HTTP GET 
local last_json_data = nil
local function ambilData(url)
    print(url)
    for i = 1, 3 do
        local success, result =
            pcall(
            function()
                return getJSON(url)
            end
        )
        if success and result then
            last_json_data = result
            return result
        else
            warn(("Percobaan %d gagal"):format(i))
            task.wait(1)
        end
    end
    warn("Semua percobaan gagal, pakai data lama.")
    return last_json_data
end
local url_listuser = USER_LIST .. player.Name
local get_user = ambilData(url_listuser)

if get_user then
    print("info")
    for _, user in ipairs(get_user.users) do
        list_sibling[user.nama] = "sibling"
        print("sibling:", user.nama)
    end
end
list_sibling[master_user] = "master"
list_sibling[master_user2] = "master"

--//ANCHOR connection
task.wait(10)

local function checkPlayers()
    local LocalPlayer = Players.LocalPlayer
	for _, list_players in pairs(Players:GetPlayers()) do
        if list_players.name ~= player.Name then 
            if list_sibling[list_players.name] == "sibling" then
                print("sibling entered")
            elseif list_sibling[list_players.name] == "master" then
                print("master entered")
                running = false
            else
                LocalPlayer:Kick("ADA PLAYER LAIN!! ", list_players.Name)
                running = false
                playing = false
                return false
            end
        end
	end
end

Players.PlayerAdded:Connect(function()
	checkPlayers()
end)
Players.PlayerRemoving:Connect(function()
    checkPlayers()
end)
local Event = Net:WaitForChild("RE/ObtainedNewFishNotification")
-- putuskan koneksi lama (opsional)
if getconnections then
    for _, conn in ipairs(getconnections(Event.OnClientEvent)) do
        conn:Disable()
    end
end

Event.OnClientEvent:Connect(function(itemId, stats, data, flag)
    if data.InventoryItem.Id == 283 then
        fav(data.InventoryItem.UUID)
    end
end)

local remote = Net:WaitForChild("RE/FishCaught")

-- variabel untuk menyimpan koneksi lama
if _G.FishCaughtConnection then
    _G.FishCaughtConnection:Disconnect()
    _G.FishCaughtConnection = nil
    print("üîå Koneksi lama diputus.")
end

-- buat koneksi baru
_G.FishCaughtConnection = remote.OnClientEvent:Connect(function(name, data)
    if running then
        lastCatchTime = os.clock()
        text_progress.Text = name .. " (" .. round(data.Weight, 2) .. " Kg)"
    end
end)

local block_bait = Net:WaitForChild("RE/BaitSpawned")
--local block_text_effect = Net:WaitForChild("RE/ReplicateTextEffect")
--local block_effect = Net:WaitForChild("RE/PlayFishingEffect")
local function block(evn)
    if getconnections then
        for _, conn in ipairs(getconnections(evn.OnClientEvent)) do
            conn:Disable()
        end
    end
end
block(block_bait)

block_bait.OnClientEvent:Connect(
    function()
    end
)
--block_text_effect.OnClientEvent:Connect(function() end)
--block_effect.OnClientEvent:Connect(function() end)
-----------------------------------------------------------------
-- teleport
-----------------------------------------------------------------

local function attachSmartPlatform(char)
    -- Buat platform sekali
    local platform = Instance.new("Part")
    platform.Name = "LocalPlatform"
    platform.Size = PLATFORM_SIZE
    platform.Anchored = true
    platform.CanCollide = true
    platform.Transparency = 0.3
    platform.Color = Color3.new(1, 0, 0)
    platform.Parent = workspace

    -- Update posisi hanya ketika karakter bergerak
    local function updatePlatform()
        platform.CFrame = CFrame.new(root.Position.X, root.Position.Y + OFFSET, root.Position.Z)
    end

    updatePlatform() -- set posisi awal

    root:GetPropertyChangedSignal("Position"):Connect(updatePlatform)

    -- Jika karakter mati / hilang
    char.AncestryChanged:Connect(
        function(_, parent)
            if not parent then
                if platform and platform.Parent then
                    platform:Destroy()
                end
            end
        end
    )
end

local function teleport(x, y, z)
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart")
    if root then
        root.CFrame = CFrame.new(Vector3.new(x, y, z))
    end
    task.wait(5)
end
local function face(yawDeg)
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart")
    if root then
        local pos = root.Position
        local yaw = math.rad(yawDeg) -- derajat ke radian
        local dir = Vector3.new(math.sin(yaw), 0, math.cos(yaw))
        root.CFrame = CFrame.lookAt(pos, pos + dir)
    end
    task.wait(2)
end
local function parseLokasi(str)
	local hasil = {}
	for part in string.gmatch(str, "([^|]+)") do
		table.insert(hasil, part)
	end
	
	return {
		nama = hasil[1],
		x = tonumber(hasil[2]),
		y = tonumber(hasil[3]),
		z = tonumber(hasil[4]),
		rotasi = tonumber(hasil[5])
	}
end
-----------------------------------------------------------------
--helper graphic
-----------------------------------------------------------------
local function SetLowGraphics()
    local Lighting = game:GetService("Lighting")
    local Terrain = workspace:FindFirstChildOfClass("Terrain")
    local MaterialService = game:GetService("MaterialService")
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
    Lighting.GlobalShadows = false
    Lighting.Brightness = 1
    Lighting.EnvironmentDiffuseScale = 0
    Lighting.EnvironmentSpecularScale = 0
    for _, effect in ipairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect.Enabled = false
        end
    end
    if Terrain then
        Terrain.WaterWaveSize = 0
        Terrain.WaterWaveSpeed = 0
        Terrain.WaterReflectance = 0
        Terrain.WaterTransparency = 1
    end
    MaterialService.Use2022Materials = false
end
local renderEnabled = true
local uiHidden = false

local function toggle3DAndUI()
    renderEnabled = not renderEnabled
    uiHidden = not uiHidden
    if renderEnabled == true then
        --setfpscap(2)
        mainFrame.BackgroundTransparency = 1
    else
        --setfpscap(15)
        mainFrame.BackgroundTransparency = 0
    end
    RunService:Set3dRenderingEnabled(renderEnabled)
    --[[
    for _, gui in ipairs(gui:GetChildren()) do
        if gui:IsA("ScreenGui") and gui ~= screenGui then
            gui.Enabled = false -- kalau render off, UI juga ikut mati
        end
    end
    --]]
end

--//ANCHOR INVENTORY

local function update_inventory()
    local Client = Replion.Client
    local replion_data = Client:WaitReplion("Data")
    local inventory = replion_data:GetExpect({"Inventory"})
    print("update inventory")
    total_harga_secret = 0
    total_harga_mythic = 0
    count_custom_inv_id = 0
    local listing = 1
    list_secret = {}
    list_fav = {}
    list_display = {}
    list_mythic = {}
    list_trade_batu = {}
    list_inv_item_uuid = {}
    for category, items in pairs(inventory) do
        if category == "Fishing Rods" then
            for _, item in ipairs(items) do
                local rod_info = list_rod[item.Id]
                if rod_info then
                    list_inventory_rod[rod_info.nama] = {
                        Id = item.Id,
                        UUID = item.UUID,
                        Name = rod_info.nama,
                        Tier = rod_info.tier,
                        Enchant = item.Metadata and item.Metadata.EnchantId or 0
                    }
                end
            end
        end
        if category == "Baits" then
            for i, item in ipairs(items) do
                local baits = ItemUtility:GetBaitData(item.Id)
                list_inventory_bait[baits.Data.Id] = {
                    Id = baits.Data.Id,
                    Name = baits.Data.Name,
                    Tier = baits.Data.Tier
                }
            end
        end
        if category == "Items" then
            for i, item in ipairs(items) do
                table.insert(list_inv_item_uuid, item.UUID)
                if item.Id == 10 then
                    table.insert(list_trade_batu, item.UUID)
                end
                if list_ikan[item.Id] then
                    local berat = item.Metadata and item.Metadata.Weight or 0
                    local variant = item.Metadata and item.Metadata.VariantId or " "
                    local nama = list_ikan[item.Id].nama
                    local uuid = item.UUID
                    
                    if list_ikan[item.Id].tier == 7 then -- total ikan secret
                        table.insert(list_secret, uuid)
                        if list_ikan[item.Id].harga then
                            total_harga_secret = total_harga_secret + list_ikan[item.Id].harga
                        end
                    end
                    if list_ikan[item.Id].tier == 6 then --total ikan mythic
                        table.insert(list_mythic, uuid)
                        if list_ikan[item.Id].harga then
                            total_harga_mythic = total_harga_mythic + list_ikan[item.Id].harga
                        end
                    end
                    if list_ikan[item.Id].tier > 6 then -- LIST TRADE
                        local text_sec = listing .. ". " .. nama .. " - " .. konvert_harga(berat) .. " Kg "  .. variant
                        table.insert(list_display, text_sec)
                        listing = listing + 1
                    end
                    if item.Id == 283 then
                        table.insert(list_fav, uuid)
                        count_custom_inv_id = count_custom_inv_id + 1
                    end
                end
                list_inventory_fishs[item.Id] = {
                    Id = item.Id,
                    UUID = item.UUID
                }
            end
        end
    end
end

--//ANCHOR BTN
closeBtn.MouseButton1Click:Connect(
    function()
        running = false
        playing = false
        screenGui:Destroy()
    end
)

btn_stop.MouseButton1Click:Connect(
    function()
        running = not running
        if not running then
            btn_stop.Text = "‚è∏Ô∏è"
            pesan("STOP")
        else
            btn_stop.Text = "‚ñ∂Ô∏è"
            pesan("START")
        end
    end
)

render_btn.MouseButton1Click:Connect(
    function()
        toggle3DAndUI()
    end
)

btn_reload.MouseButton1Click:Connect(
    function()
        rejoinSameServer()
    end
)
--//ANCHOR TRADE 
local function custom_trade(custom_list, limit)
    local completed = false
    Net:WaitForChild("RE/TextNotification").OnClientEvent:Connect(
        function(data)
            print("ADA NOTIF: ", data.Text)
            if data and data.Text == "Trade completed!" then
                completed = true
            end
        end
    )
    update_inventory()
    running = false
    --local targetName = "hayfish96"
    local berhasil = 0
    local info_akhir = ""
    local function trade_user(usr)
        print("Player ditemukan:", usr.Name, "UserId:", usr.UserId)
        if custom_list ~= nil then
            for i, uuid in ipairs(custom_list) do
                Net:WaitForChild("RE/EquipItem"):FireServer(uuid, "Fishes")
                Net:WaitForChild("RF/InitiateTrade"):InvokeServer(usr.UserId, uuid)
                local timeout = 0
                while completed ~= true do
                    print("wait")
                    timeout = timeout + 1
                    if timeout > 30 then
                        print("timeout lebih dari 15 detik")
                        break
                    end
                    task.wait(0.4)
                end
                if timeout < 30 then
                    berhasil = berhasil + 1
                end
                completed = false
                info_akhir = "TRADE " .. berhasil .. "/" .. #custom_list
                pesan(info_akhir)
                task.wait(3)
                if limit > 0 and i > limit then
                    print("limit trade telah tercapai")
                    break
                end
            end
        else
            pesan("tidak ada barang lagi")
        end
        update_inventory()
        pesan("SELESAI SEMUA " .. info_akhir)
        print("clear list")
    end
    local existing = Players:FindFirstChild(master_user)
    local existing2 = Players:FindFirstChild(master_user2)
    if existing then
        trade_user(existing)
    elseif existing2 then
        trade_user(existing2)
    else
        pesan("player tidak ada")
    end
end
--//ANCHOR - Enchant
local function auto_enchant(ids)
    update_inventory()
    pesan("set enchant to " .. info_enchant(ids).Data.Name)
    teleport(3243, -1302, 1402)
    local RollEnchant = Net:WaitForChild("RE/RollEnchant")
    local flag_berhasil_enchant = false
    RollEnchant.OnClientEvent:Connect(
        function(waktu, id, v, flag)
            if id == ids then 
                flag_berhasil_enchant = true
                pesan("berhasil : " .. info_enchant(id).Data.Name)
            end
            print("hasil enchant: " .. info_enchant(id).Data.Name)
        end
    )

    print("start")
    for i, k in ipairs(list_inv_item_uuid) do
        Net:WaitForChild("RE/UnequipItem"):FireServer(k)
        task.wait(0.1)
    end
    print("total batu = ", #list_trade_batu)
    for i, k in ipairs(list_trade_batu) do
        print("enchant ke " .. i .. "/" .. #list_trade_batu)
        Net:WaitForChild("RE/EquipItem"):FireServer(k, "Enchant Stones")
        task.wait(1)
        Net:WaitForChild("RE/EquipToolFromHotbar"):FireServer(2)
        task.wait(1)
        Net:WaitForChild("RE/ActivateEnchantingAltar"):FireServer()
        task.wait(2)
        for i = 1, 10 do
            print("tunggu ", i)
            task.wait(1)
        end
        if i > #list_trade_batu or flag_berhasil_enchant == true then
            print("selesai enchant")
            break
        end
        if not playing then break end
       print("next enchant >>")
    end
    pesan("selesai enchant")
end

--//ANCHOR best rod and bait wear
local function best_rod_wear()
    local old_tier = 0
    local current_uuid = ""
    local best = nil
    local current_enchant_id = 0
    for name, v in pairs(list_inventory_rod) do
        if v.Tier > old_tier then
            old_tier = v.Tier
            current_uuid = v.UUID
            best = v.Name
            current_enchant_id = v.Enchant
        end
    end
    if current_uuid ~= "" then
        if current_enchant_id ~= 0 then
            current_rod_enchant = info_enchant(current_enchant_id).Data.Name
        else
            text_rod_enchant.Text = "no enchant"
        end
        Net:WaitForChild("RE/EquipItem"):FireServer(current_uuid, "Fishing Rods")
        return best
    else
        print("‚ö†Ô∏è Tidak ada rod ditemukan.")
    end
end
local function best_bait_wear()
    local order_bait = {18,20,15,3,1}
    for _,ids in ipairs(order_bait) do
        if list_inventory_bait[ids] ~= nil then
            print("best bait: ")
            wear_bait(ids)
            return list_inventory_bait[ids].Name
        end
    end
end
local function cek_merchant()
local scrollingFrame = gui:WaitForChild("Merchant").Main.Background.Items.ScrollingFrame
    koin = gui:WaitForChild("Events").Frame.CurrencyCounter.Counter.Text
    local koins = convert(koin)
    if list_inventory_bait[18] == nil and koins > 8300000 then
        for _, imageLabel in ipairs(scrollingFrame:GetDescendants()) do
            if imageLabel:IsA("ImageLabel") then
                if imageLabel.Name == "Template" then
                    local itemName = imageLabel:WaitForChild("Frame"):FindFirstChild("ItemName").Text
                    local itemPrice = imageLabel:WaitForChild("Frame"):FindFirstChild("Frame"):FindFirstChild("Price").Text
                    print(itemName .."|".. itemPrice)
                    if itemName == "Singularity Bait" then
                        pesan("! ADA !" .. itemName .. "|" .. itemPrice)
                        teleport(-135, 3, 2767)
                        local status, data =  Net:WaitForChild("RF/PurchaseMarketItem"):InvokeServer(3)
                        if status then
                            pesan("berhasill beli singularity")
                            running  = true
                            return true
                        else
                            running = false
                            return false
                        end
                    end
                end
            end
        end
    end
    return false
end
local numbers = {}
local function teleport_string(data)
    for value in string.gmatch(data, "[-%d%.]+") do
        table.insert(numbers, tonumber(value))
    end
    return numbers[1], numbers[2], numbers[3], numbers[4]
end
local function quest_deep_sea(index)
    local path = workspace["!!! MENU RINGS"]["Deep Sea Tracker"].Board.Gui.Content
    local label = path:FindFirstChild("Label" .. index)
    if label and label:IsA("TextLabel") then
        return label.Text
    else
        print("quest not found")
        return 0
    end
end
local function quest_jungle(index)
    local path = workspace["!!! MENU RINGS"]["Element Tracker"].Board.Gui.Content
    local label = path:FindFirstChild("Label" .. index)
    if label and label:IsA("TextLabel") then
        return label.Text
    else
        print("quest not found")
        return 0
    end
end
--// ANCHOR UPDATE QUEST
local function update_quest()
    if select_quest == "jungle" then
        progress_quest1 = cek_quest(quest_jungle(1))
        progress_quest2 = cek_quest(quest_jungle(2))
        progress_quest3 = cek_quest(quest_jungle(3))
        progress_quest4 = cek_quest(quest_jungle(4))
    elseif select_quest == "deep_sea" then
        progress_quest1 = cek_quest(quest_deep_sea(1))
        progress_quest2 = cek_quest(quest_deep_sea(2))
        progress_quest3 = cek_quest(quest_deep_sea(3))
        progress_quest4 = cek_quest(quest_deep_sea(4))
    end
    local x = select_quest .. " > " .. progress_quest1 .. " - " .. progress_quest2 .. " - " .. progress_quest3 .. " - " .. progress_quest4
    text_progress.Text = x
end
--//ANCHOR auto buy
local function auto_buy()
    print("start auto buy")
    koin = gui:WaitForChild("Events").Frame.CurrencyCounter.Counter.Text
    local koins = convert(koin)
    if list_inventory_rod["Midnight Rod"] == nil and koins > 50000 then
        print("beli rod midnight")
        task.wait(10)
        auto_buy_bait(3) -- corrupt
        wear_bait(3)
        auto_buy_rod(80) -- midnight rod
        best_rod_wear()
    end
    if koins > 1150000 and list_inventory_rod["Astral Rod"] == nil then
        print("beli rod astral")
        task.wait(10)
        auto_buy_rod(5) -- astral rod
        best_rod_wear()
    end
    -- buy corrupt bait
    if  koins > 1150000 and list_inventory_bait[15] == nil then
        auto_buy_bait(15)
        task.wait(2)
        wear_bait(15)
    end
    -- buy floral bait
    if  koins > 4000000 and list_inventory_bait[20] == nil then
        auto_buy_bait(20)
        task.wait(2)
        wear_bait(20)
    end
end

--//ANCHOR auto fish

local function auto_fish(waktu)
    math.randomseed(os.time())
    local random_number = math.random() * 2 - 1
    Net["RF/ChargeFishingRod"]:InvokeServer(nil,nil,nil,tick())
    task.wait(0.1)
    local success, data = Net["RF/RequestFishingMinigameStarted"]:InvokeServer(random_number, 1.0, tick()-1.5)
    if success then
        waktu = waktu or 1.2
        task.wait(waktu)
        Net["RE/FishingCompleted"]:FireServer()
        task.wait(0.4)
        Net:WaitForChild("RF/CancelFishingInputs"):InvokeServer(tick()-1.5)
        count_mancing = count_mancing + 1
    end
end

local function hapus_gui_daily()
    if dailyLoginGui and dailyLoginGui:IsA("ScreenGui") then
        if dailyLoginGui.Enabled then
            dailyLoginGui.Enabled = false
        end
    end
    local playerList = game:GetService("CoreGui"):FindFirstChild("PlayerList")
    if playerList then
        playerList.Enabled = false
    end
end

--//ANCHOR OPSI FUNCTION

function opsi(index)
    if running then
        pesan("please stop running !")
        return
    end
    if index == 1 then -- ROW I
        custom_trade(list_secret, 0)
    elseif index == 2 then
        custom_trade(list_mythic, 0)
    elseif index == 3 then
        custom_trade(list_trade_batu, 20)
    elseif index == 4 then
    elseif index == 5 then
        -- variabel untuk menyimpan koneksi lama
        if _G.FishCaughtConnection then
            _G.FishCaughtConnection:Disconnect()
            _G.FishCaughtConnection = nil
            print("üîå Koneksi lama diputus.")
        end

        -- buat koneksi baru
        _G.FishCaughtConnection = remote.OnClientEvent:Connect(function(name, data)
            if running then
                lastCatchTime = os.clock()
                text_progress.Text = name .. " (" .. round(data.Weight, 2) .. " Kg)"
            end
        end)
    elseif index == 6 then
        pesan("Waiting to trade....")
        local RF = Net:WaitForChild("RF/AwaitTradeResponse")
        RF.OnClientInvoke = function(...)
            local args = {...}
            local maybeData = args[2]
            if type(maybeData) == "table" then
                print("Trade offer:", maybeData.Id, maybeData.UUID)
            end
            task.wait(4.5)
            pesan("Trade Accepted")
            return "OK"
        end
    elseif index == 7 then -- ROW 2
        auto_buy()
    elseif index == 8 then
        cek_merchant()
    elseif index == 9 then
        local jobId = game.JobId
        if setclipboard then
            setclipboard(jobId)
            task.wait(1.5)
            pesan("berhasil copy job id")
        else
            pesan("gagal copy job id")
        end
    elseif index == 10 then
       stop_global_control = not stop_global_control
       pesan("global control set: " .. tostring(stop_global_control))
    elseif index == 11 then
        -- manual teleport
         pesan("custom teleport")
        global_event = true
        select_quest = "custom_teleport"

    elseif index == 12 then
        pesan("global event trigger")
        global_event = true
        select_quest = "event"
    elseif index == 13 then -- ROW II
        teleport(3243, -1302, 1402) -- enchant I
    elseif index == 14 then
         auto_enchant(9) --empowered
    elseif index == 15 then
        auto_enchant(14) -- mutation ii
    elseif index == 16 then
        auto_enchant(12) --cursed
    elseif index == 17 then
        auto_enchant(13) -- prismatic
    elseif index == 18 then
        teleport(1486, 128, -592) -- enchant II 
    end
    lastCatchTime = os.clock()
end
local function display_inventory()
    local list = "FAV: " .. count_custom_inv_id .. " \n total stone : " .. #list_trade_batu
    if list_display then
        for i, k in ipairs(list_display) do
            list = list .. " \n " .. k
        end
        return list
    else
        return "tidak ada secret :("
    end
end
--//ANCHOR send web data 
local function send_Data(running_time, koin_secret, koin_myth, activity, total_fishing,quest)
    local progress = (progress_quest1 + progress_quest2 + progress_quest3 + progress_quest4) / 4
    local nama = player.Name
    local job_id = current_bait
    local rod = current_rod
    local list_inv = display_inventory()
    koin = gui:WaitForChild("Events").Frame.CurrencyCounter.Counter.Text
    local lokasi = player:GetAttribute("LocationName")
    local params = string.format(
        "?nama=%s&lokasi=%s&rod=%s&koin=%s&koin_secret=%s&koin_myth=%s&running_time=%s&activity=%s&total_fishing=%s&job_id=%s&progress=%s&quest=%s&inventory=%s",
        nama,
        HttpService:UrlEncode(tostring(lokasi)),
        HttpService:UrlEncode(tostring(rod)),
        HttpService:UrlEncode(koin),
        HttpService:UrlEncode(tostring(koin_secret)),
        HttpService:UrlEncode(tostring(koin_myth)),
        HttpService:UrlEncode(tostring(running_time)),
        HttpService:UrlEncode(tostring(activity)),
        total_fishing,
        job_id,
        HttpService:UrlEncode(tostring(progress)),
        HttpService:UrlEncode(tostring(quest)),
        HttpService:UrlEncode(tostring(list_inv))
    )
    local url = SERVER_URL .. params
    task.spawn(function()
        local ok, res = pcall(function()
            return request({Url = url, Method = "GET"})
        end)
        if ok and res then
            print("OK:", res.StatusCode)
        else
            warn("Request error:", res)
        end
    end)
end

--//ANCHOR Unlocker
local flag_unlocker = {0, 0, 0, 0}
local all_unlocked = false
local function check_unlocker()
    for i,v in ipairs(list_item_unlocker) do
        if flag_unlocker[i] == 0 then
            if(list_inventory_fishs[v] ~= nil) then
                flag_unlocker[i] = 1
                print("unlocker ada item: ", list_inventory_fishs[v].Id)
                fav(list_inventory_fishs[v].UUID)
            end
        end
    end
    for _, val in ipairs(flag_unlocker) do
        if val == 1 then
            all_unlocked = true
            break
        end
    end
    if all_unlocked then
        print("semua item telah unlock")
        running = false
    end
end
--]]
-- //ANCHOR SPAWN
--------------------------------------------------------------------
--- SPAWN
--------------------------------------------------------------------

task.spawn(
    function()
        local num = 1
        local flag_error = false
        local running_time
        local benchmark_speed = 0.0
        local count_benchmark = 0
        local total_benchmark = 0
        local old_catch
        local last_delta = 0
        local old_fishing = 0
        while playing do
            local currentTime = os.clock()
            running_time = formatTime(math.floor(getOnlineTime()))
            text_jam.Text = running_time
            if lastCatchTime then
                local delta = currentTime - lastCatchTime
                delta = math.floor(delta * 10 + 0.5) / 10
                if old_catch == lastCatchTime then
                    last_delta = delta
                else
                    count_benchmark = count_benchmark + 1
                    total_benchmark = total_benchmark + last_delta
                end
                old_catch = lastCatchTime
                if delta < 30 then
                    flag_error = false
                    text_timer.Text = delta .. " sec."
                else
                    flag_error = true
                    text_timer.Text =  delta .. " sec."
                end
                if delta > 180 then
                    pesan("! OVER !")
                    --rejoinSameServer()
                    task.wait(60)
                end
            end
            if count_benchmark >= 10 then
                benchmark_speed = round(total_benchmark / (count_benchmark),2)
                count_benchmark = 0
                total_benchmark = 0
                print("rod speed : ", benchmark_speed)
                text_rod_speed.Text = "‚ö° : " .. tostring(benchmark_speed)
            end
            if flag_error == true and num % 15 == 0 then
                task.wait(0.5)
                Net:WaitForChild("RF/CancelFishingInputs"):InvokeServer(tick())
                task.wait(0.5)
                Net:WaitForChild("RE/FishingCompleted"):FireServer()
                task.wait(0.5)
            end
            if running and num % 300 == 0 then
                update_inventory()
                update_quest()
                --check_unlocker()
                Net:WaitForChild("RE/EquipToolFromHotbar"):FireServer(1)
                task.wait(2)
                Net:WaitForChild("RF/SellAllItems"):InvokeServer(now)
                task.wait(2)
                hapus_gui_daily()
                text_rod.Text = current_rod
                text_bait.Text = current_bait
                print("total mythic : ", #list_mythic)
                print("total uang:", koin)

                local web_control = ambilData(CONFIG_URL)
                if stop_global_control == false then
                    if web_control then
                        web_enable = web_control.enable_event
                        web_location = web_control.custom_location
                        if web_enable == 1 then
                            if current_rod == "Ghostfinn Rod" or current_rod == "Element Rod" then
                                text_online.Text = "üü¢ global enabled"
                                if web_location ~= web_old_location then
                                    pesan("global control enable")
                                    select_quest = "global event"
                                    global_event = true
                                    running = false
                                    web_old_location = web_location
                                end
                            end
                        else
                            text_online.Text = ""
                            global_event = false
                        end
                    end
                else
                    text_online.Text = "üî¥ global Disabled"
                end
            end
            if num % 100 == 0 then
                print("kirim data at: ", running_time)
                if old_fishing ~= count_mancing then
                    send_Data(running_time, total_harga_secret, total_harga_mythic, last_msg, count_mancing, select_quest)
                    old_fishing =count_mancing
                end
            end
            num = num + 1
            task.wait(1)
        end
        print("!! spawn exit !!")
    end
)

local RF = Net:WaitForChild("RF/AwaitTradeResponse")
RF.OnClientInvoke = function(...)
    local args = {...}
    local maybeData = args[2]
    if type(maybeData) == "table" then
        print("ada trade:", maybeData.Id, maybeData.UUID)
    end
    if maybeData.Id == 163 then -- vyper fish
        print("start kirim ikan")
        running = false
        task.wait(10)
        if total_harga_mythic > 500000 then -- minimal 500k
            custom_trade(list_mythic, 0)
            task.wait(10)
        end
        custom_trade(list_secret, 0)
        task.wait(10)
        if #list_fav > 0 then
            custom_trade(list_fav, 0)
        end
        running = true
        lastCatchTime = os.clock()
        Net:WaitForChild("RE/EquipToolFromHotbar"):FireServer(1)
        pesan("SELESAI TRADE")
        send_Data("", 0, 0, last_msg, count_mancing, select_quest)
        return "CANCEL"
    else
        if list_ikan[maybeData.Id] then
            pesan(list_ikan[maybeData.Id].nama)
        end
        task.wait(3)
        return "OK"
    end
end
--//ANCHOR MAIN

---------------------------------------------
---MULAI ALGORITMA
---------------------------------------------
-- TWEAK
--Net:WaitForChild("RE/ChangeSetting"):FireServer("Server Notifications", false)
--Net:WaitForChild("RE/ChangeSetting"):FireServer("Global Notifications", false)

send_Data("0", total_harga_secret, total_harga_mythic, "START", "0","0")
task.wait(5)
update_inventory()
if cek_merchant() == true then
    update_inventory()
end
hapus_gui_daily()
SetLowGraphics()
print("INISIALISASI ------COUNTDOWN")
---countdown
local countdown = 5
text_progress.Text = "Auto Play in: "
if running then
    for i = 1, countdown do
        local elapsed = countdown - i
        pesan(elapsed)
        task.wait(1)
        if not running then 
            pesan("Autoplay stoped")
            break
        end
    end
end
---jika ada countdown tunggu
while not running do
    text_progress.Text = "Waiting Running..."
    task.wait(15)
    if not playing then break end
end

if running then
    pesan("inisialisasi awal")
    -- inisialisasi awal bait , 3d config, check player, quest, auto buy
    checkPlayers()
    toggle3DAndUI()
    update_quest()
    auto_buy()
    -- add platform
    player.CharacterAdded:Connect(attachSmartPlatform)
    if player.Character then
        attachSmartPlatform(player.Character)
    end
    -- wear best rod and bait

    current_rod = best_rod_wear() or "-"
    text_rod.Text = current_rod
    current_bait = best_bait_wear() or "-"
    text_bait.Text = current_bait
    Net:WaitForChild("RE/EquipToolFromHotbar"):FireServer(1)

    -- tentukan aktifitas
    if current_rod == "Ghostfinn Rod" then
        select_quest = "jungle"
    elseif current_rod == "Element Rod" then
        select_quest = "custom_teleport"
    elseif current_rod == "Astral Rod" then
        select_quest = "deep_sea"
    else
        select_quest = "farming_coin"
    end

    --make AUTO ENCHANT if rod dont have enchant
    if current_rod_enchant then
        text_rod_enchant.Text = "(" .. current_rod_enchant .. ")"
    else
        if current_rod == "Ghostfinn Rod" or current_rod == "Element Rod" then
            pesan("rod belum di enchant")
            if #list_trade_batu > 0 then
                auto_enchant(12)
                update_inventory()
                best_rod_wear()
                text_rod_enchant.Text = "(" .. current_rod_enchant .. ")"
            end
        end
    end
end
pesan("START ACTIVITY")

if running and select_quest == "farming_coin" then
    pesan("farming koin starter")
    teleport(-650, 46, 169)
    face(0)
    local c = 0
    while running do
        auto_fish(3.5)
        if c % 200 == 0 then
            auto_buy()
            current_rod = best_rod_wear()
            if current_rod == "Astral Rod" then
                break
            end
        end
        c = c + 1
    end
    if running then
        pesan("selesai farming koin")
        select_quest = "deep_sea"
    end
    task.wait(10)
end

if running then
    local web_control = ambilData(CONFIG_URL)
    if web_control then
        web_enable = web_control.enable_event
        web_location = web_control.custom_location
    end
    if web_enable == 1 then
        if current_rod == "Ghostfinn Rod" or current_rod == "Element Rod" then
            select_quest = "global event"
            global_event = true
        end
    end
end
while playing do
    if running and select_quest == "deep_sea" then
        Net:WaitForChild("RF/UpdateAutoSellThreshold"):InvokeServer(5)  -- autosell switch to legendary

        -- farming stone
        total_stone = #list_trade_batu
        local limit_stone = 10
        if total_stone < limit_stone then
            pesan("stone < " .. limit_stone)
            teleport(3263, -1302, 1409)
            face(0)
            local z = 0
            while running and total_stone < limit_stone do
                auto_fish(2)
                z = z + 1
                if z % 50 == 0 then
                    total_stone = #list_trade_batu
                    pesan("farm stone: " .. total_stone)
                end
            end
        end

        while playing do
            if running and progress_quest1 < 100 then
                pesan(quest_deep_sea(1))
                teleport(-3602, -283, -1612)
                face(120)
                local z = 1
                while running and progress_quest1 < 100 do
                    auto_fish(2)
                end
            end
            if running and ((progress_quest2 + progress_quest3 + progress_quest4) / 3) < 100 then
                pesan(quest_deep_sea(3))
                teleport(-3734, -135, -1013)
                face(0)
                while running and ((progress_quest2 + progress_quest3 + progress_quest4) / 3) < 100 do
                    auto_fish(2)
                end
            end
            if running and ((progress_quest1 + progress_quest2 + progress_quest3 + progress_quest4) / 4) >= 100 then
                pesan("selesai deep sea quest")
                select_quest = "jungle"
                break
            end
            if global_event == true then
                break
            end
            task.wait(15)
            text_timer.Text = "waiting running deep sea quest"
        end
    end
    if running and select_quest == "jungle" then
        local exists = workspace["JUNGLE INTERACTIONS"].Doors.TempleDoor:FindFirstChild("DELETE_ME_AFTER_UNLOCK")

        if exists then
            print("Model ditemukan!")
            step = 1
        else
            step = 3
        end

        while playing do
            if step == 0 then
                break
            end
            if step == 1 then
                if running and list_inventory_fishs[265] == nil then
                    pesan("farming artifak > 1. Arrow")
                    teleport(884, 7, -370)
                    face(270)
                    while running and list_inventory_fishs[265] == nil do
                        auto_fish()
                    end
                end
                if running and list_inventory_fishs[266] == nil then
                    pesan("farming artifak > 2. cressent")
                    teleport(1404, 4, 122)
                    face(0)
                    while running and list_inventory_fishs[266] == nil do
                        auto_fish()
                    end
                end
                if running and list_inventory_fishs[267] == nil then
                    pesan("farming artifak > 3. diamond")
                    teleport(1840, 4, -296)
                    face(90)
                    while running and  list_inventory_fishs[267] == nil do
                        auto_fish()
                    end
                end
                if running and list_inventory_fishs[271] == nil then
                    pesan("farming artifak > 4. Hourglass")
                    teleport(1490, 6, -848)
                    face(0)
                    while running and list_inventory_fishs[271] == nil do
                        auto_fish()
                    end
                end
                if running and list_inventory_fishs[265] ~= nil and list_inventory_fishs[266] ~= nil and list_inventory_fishs[267] ~= nil and list_inventory_fishs[271] ~= nil then
                    pesan("selesai farming artifak")
                    step = step + 1
                end
            end

            if step == 2 then
                local list_artifak = {265, 266, 267, 271}
                for i, k in ipairs(list_artifak) do
                    if list_inventory_fishs[k] ~= nil then
                        if i == 1 then
                            teleport(897, 8, -361)
                            Net:WaitForChild("RE/EquipItem"):FireServer(list_inventory_fishs[k].UUID, "Fishes")
                            task.wait(1)
                            Net:WaitForChild("RE/PlaceLeverItem"):FireServer("Arrow Artifact")
                            task.wait(1)
                        end
                        if i == 2 then
                            teleport(1420, 31, 79)
                            Net:WaitForChild("RE/EquipItem"):FireServer(list_inventory_fishs[k].UUID, "Fishes")
                            task.wait(1)
                            Net:WaitForChild("RE/PlaceLeverItem"):FireServer("Crescent Artifact")
                            task.wait(1)
                        end
                        if i == 3 then
                            teleport(1819, 8, -284)
                            Net:WaitForChild("RE/EquipItem"):FireServer(list_inventory_fishs[k].UUID, "Fishes")
                            task.wait(1)
                            Net:WaitForChild("RE/PlaceLeverItem"):FireServer("Diamond Artifact")
                            task.wait(1)
                        end
                        if i == 4 then
                            teleport(1485, 8, -861)
                            Net:WaitForChild("RE/EquipItem"):FireServer(list_inventory_fishs[k].UUID, "Fishes")
                            task.wait(1)
                            Net:WaitForChild("RE/PlaceLeverItem"):FireServer("Hourglass Diamond Artifact")
                            task.wait(1)
                        end
                    end
                end
                task.wait(60)
                pesan("TUNGGU PINTU TERBUKA")
                step = 3
                Net:WaitForChild("RE/EquipToolFromHotbar"):FireServer(1) -- wear rod 
                task.wait(30)
            end

            if step == 3 then
                if running and progress_quest3 < 100 then
                    pesan(quest_jungle(3)) -- inside temple
                    teleport(math.random(1491,1516), -22, -630)
                    face(0)
                    while running and progress_quest3 < 100 do
                        auto_fish()
                    end
                end
                if running and progress_quest2 < 100 then
                    pesan(quest_jungle(2)) -- in the forest
                    teleport(1066, 5, 157)
                    face(0)
                    while running and progress_quest2 < 100 do
                        auto_fish()
                    end
                end
                if running and progress_quest4 < 100 then
                    teleport(1487, 128, -591)
                    pesan("SELESAI MANUAL SACRIFICE")
                    task.wait(30)
                end
            end
            if global_event == true then
                break
            end
            text_timer.Text = "waiting running jungle quest"
            task.wait(15)
        end
    end
    if running and select_quest == "event" then
        pesan("farming event")
        local function getAllMegalodonHuntPivots()
            local menuRings = workspace:FindFirstChild("!!! MENU RINGS")
            for _, child in ipairs(menuRings:FindFirstChild("Props"):GetChildren()) do
                if child.Name == "Megalodon Hunt" and child:IsA("Model") then
                    local pivot = child:GetPivot().Position
                    pesan("Event: " .. child.Name)
                    return pivot.x, pivot.y, pivot.z
                end
            end
            return nil
        end
        while playing do
            local pos = getAllMegalodonHuntPivots()
            if pos then
                local old_pos = 0
                while playing do 
                    x, y , z  = getAllMegalodonHuntPivots()
                    local xx = round(x,1)
                    local zz = round(z,1)
                    if xx == old_pos then
                        print("posisi masih sama")
                    else
                        print("new event position", xx, zz)
                        teleport(xx - 10, 10 ,zz - 10)
                        old_pos = xx
                        running = true
                    end
                    for i=0, 50 do
                        auto_fish()
                        if not playing then break end
                    end
                    print("checking new event")
                    task.wait(3)
                end
            else
                select_quest = "custom_teleport"
                break
            end
        end
    end
    if running and select_quest == "custom_teleport" then
        --list teleport
            teleport(948, 3, 5114) -- crater island
            face(120)
            --teleport(6098, -586, 4677) --group fishing

        --teleport(2144, 81, 3271) --mountain hallow
        --face(0)
        task.wait(5)
        pesan("fishing : " .. player:GetAttribute("LocationName"))
        while running do
            auto_fish()
        end
    end
    if select_quest == "global event" or global_event == true then
        running = true
        --if running then
            local web_parse = parseLokasi(web_location)
            pesan("EVENT:" .. web_parse.nama)
            teleport(web_parse.x, web_parse.y, web_parse.z)
            face(web_parse.rotasi)
            task.wait(5)
            while running and global_event == true do
                auto_fish()
            end
        --end
    end
    -- reset ke quest
    if running and global_event == false then
        if current_rod == "Ghostfinn Rod" then
            select_quest = "jungle"
        elseif current_rod == "Element Rod" then
            select_quest = "custom_teleport"
        elseif current_rod == "Astral Rod" then
            select_quest = "deep_sea"
        else
            select_quest = "farming_coin"
        end
    end
    task.wait(15)
end
running = false
global_event = false

print("-----------------end-------------")
--]]
-----------------------------------------------------------------
--               E N D     M A I N
-----------------------------------------------------------------
