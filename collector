local versi = "NEW UI - V1.3.1" -- change list item  to dictionary
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local root = character:WaitForChild("HumanoidRootPart")

local gui = player:WaitForChild("PlayerGui")
local Net =
    ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild(
    "net"
)
local RF = Net:WaitForChild("RF/AwaitTradeResponse")

local Client = require(ReplicatedStorage.Packages.Replion).Client
local ItemUtility = require(ReplicatedStorage.Shared.ItemUtility)
local TierUtility = require(ReplicatedStorage.Shared.TierUtility)
local Variants = ReplicatedStorage:WaitForChild("Variants")

local dump_inventory = false
local trade_stop = false
local running = true
local start_timer = false
local startscript = tick()
local printer = "List Transaksi: "
local berat_min = 50000  -- berat trade secret minimal berapa kilo ?
-- ScreenGui utama
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CollectorUI"
screenGui.Parent = gui

-- Frame utama (putih)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 600, 0, 400)
mainFrame.Position = UDim2.new(0, 10, 0, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
mainFrame.BackgroundTransparency = 0.1
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- === KIRI : PLAYER LIST ===
local playerFrame = Instance.new("Frame")
playerFrame.Size = UDim2.new(0.35, 0, 1, -10)
playerFrame.Position = UDim2.new(0, 5, 0, 5)
playerFrame.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
playerFrame.Parent = mainFrame


-- Tombol Close
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 25, 0, 25)
closeBtn.Position = UDim2.new(0, 10, 0, 5)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.new(0, 0, 0)
closeBtn.BackgroundColor3 = Color3.fromRGB(194, 62, 62)
closeBtn.Parent = playerFrame

-- Tombol reload
local reloadBtn = Instance.new("TextButton")
reloadBtn.Size = UDim2.new(0, 25, 0, 25)
reloadBtn.Position = UDim2.new(0, 60, 0, 5)
reloadBtn.Text = "R"
reloadBtn.TextColor3 = Color3.new(1,1,1)
reloadBtn.BackgroundColor3 = Color3.fromRGB(0, 89, 255)
reloadBtn.Parent = playerFrame

-- Tombol 3d
local renderBtn = Instance.new("TextButton")
renderBtn.Size = UDim2.new(0, 25, 0, 25)
renderBtn.Position = UDim2.new(0, 90, 0, 5)
renderBtn.Text = "3D"
renderBtn.TextColor3 = Color3.new(1,1,1)
renderBtn.BackgroundColor3 = Color3.fromRGB(202, 50, 151)
renderBtn.Parent = playerFrame

closeBtn.MouseButton1Click:Connect(function()
    trade_stop = true
    running = false
	screenGui:Destroy()
end)



local listLabel = Instance.new("TextLabel")
listLabel.Size = UDim2.new(1, 0, 0, 80)
listLabel.BackgroundTransparency = 1
listLabel.Text = "Collector " .. versi
listLabel.TextXAlignment = Enum.TextXAlignment.Left
listLabel.TextColor3 = Color3.new(0, 0, 0)
listLabel.Font = Enum.Font.RobotoMono
listLabel.TextSize = 16
listLabel.Parent = playerFrame

local listScroll = Instance.new("ScrollingFrame")
listScroll.Size = UDim2.new(1, -10, 0.8, 0)
listScroll.Position = UDim2.new(0, 5, 0, 65)
listScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
listScroll.ScrollBarThickness = 6
listScroll.BackgroundTransparency = 0.7
listScroll.Parent = playerFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 5)
listLayout.Parent = listScroll

listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
	listScroll.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 10)
end)

-- === KANAN : INFO DAN KONTROL ===
local rightFrame = Instance.new("Frame")
rightFrame.Size = UDim2.new(0.6, 0, 1, -10)
rightFrame.Position = UDim2.new(0.4, 0, 0, 5)
rightFrame.BackgroundTransparency = 1
rightFrame.Parent = mainFrame

-- Statistik info
local statsLabel = Instance.new("TextLabel")
statsLabel.Text = "Statistik Info\n\nData A: XXXX\nData B: XXXX\nData C: XXXX"
statsLabel.Size = UDim2.new(1, 0, 0, 80)
statsLabel.Position = UDim2.new(0, 0, 0, 20)
statsLabel.TextXAlignment = Enum.TextXAlignment.Left
statsLabel.BackgroundTransparency = 1
statsLabel.TextColor3 = Color3.new(0,0,0)
statsLabel.Font = Enum.Font.Roboto
statsLabel.TextSize = 20
statsLabel.Parent = rightFrame

-- Input jumlah
local amountBox = Instance.new("TextBox")
amountBox.Text = "jumlah"
amountBox.PlaceholderText = "in M..."
amountBox.Size = UDim2.new(0, 60, 0, 25)
amountBox.Position = UDim2.new(0, 0, 0, 120)
amountBox.BackgroundColor3 = Color3.fromRGB(210, 210, 210)
amountBox.TextColor3 = Color3.new(0,0,0)
amountBox.Font = Enum.Font.RobotoMono
amountBox.TextSize = 16
amountBox.Parent = rightFrame

local selectedLabel = Instance.new("TextLabel")
selectedLabel.Text = "Selected player:"
selectedLabel.Size = UDim2.new(1, 0, 0, 20)
selectedLabel.Position = UDim2.new(0, 0, 0, 90)
selectedLabel.BackgroundTransparency = 1
selectedLabel.TextColor3 = Color3.new(0,0,0)
selectedLabel.Font = Enum.Font.RobotoMono
selectedLabel.TextSize = 18
selectedLabel.Parent = rightFrame

-- Tombol Trade
local tradeBtn = Instance.new("TextButton")
tradeBtn.Text = "Mythc"
tradeBtn.Size = UDim2.new(0, 50, 0, 25)
tradeBtn.Position = UDim2.new(0, 70, 0, 120)
tradeBtn.BackgroundColor3 = Color3.fromRGB(241, 129, 0)
tradeBtn.TextColor3 = Color3.new(1,1,1)
tradeBtn.Font = Enum.Font.RobotoMono
tradeBtn.TextSize = 16
tradeBtn.Parent = rightFrame

local tradeSecret = Instance.new("TextButton")
tradeSecret.Text = "Scret"
tradeSecret.Size = UDim2.new(0, 50, 0, 25)
tradeSecret.Position = UDim2.new(0, 120, 0, 120)
tradeSecret.BackgroundColor3 = Color3.fromRGB(24, 161, 179)
tradeSecret.TextColor3 = Color3.new(1,1,1)
tradeSecret.Font = Enum.Font.RobotoMono
tradeSecret.TextSize = 16
tradeSecret.Parent = rightFrame

local allBtn = Instance.new("TextButton")
allBtn.Text = "All"
allBtn.Size = UDim2.new(0, 40, 0, 25)
allBtn.Position = UDim2.new(0, 170, 0, 120)
allBtn.BackgroundColor3 = Color3.fromRGB(243, 219, 6)
allBtn.TextColor3 = Color3.fromRGB(34, 34, 34)
allBtn.Font = Enum.Font.RobotoMono
allBtn.TextSize = 16
allBtn.Parent = rightFrame

local stopBtn = Instance.new("TextButton")
stopBtn.Text = "STOP"
stopBtn.Size = UDim2.new(0, 60, 0, 25)
stopBtn.Position = UDim2.new(0, 220, 0, 120)
stopBtn.BackgroundColor3 = Color3.fromRGB(243, 6, 6)
stopBtn.TextColor3 = Color3.fromRGB(253, 253, 253)
stopBtn.Font = Enum.Font.RobotoMono
stopBtn.TextSize = 16
stopBtn.Parent = rightFrame


-- === Buat tombol toggle ===
local settingBtn = Instance.new("TextButton")
settingBtn.Text = "Collect: OFF"
settingBtn.Size = UDim2.new(1, 0, 0, 25)
settingBtn.Position = UDim2.new(0, 0, 1, 0) -- di bawah tombol trade / log
settingBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
settingBtn.TextColor3 = Color3.new(1,1,1)
settingBtn.Font = Enum.Font.RobotoMono
settingBtn.TextSize = 16
settingBtn.Parent = playerFrame

-- === Buat tombol toggle ===
local dumpBtn = Instance.new("TextButton")
dumpBtn.Text = "Dump"
dumpBtn.Size = UDim2.new(0, 80, 0, 25)
dumpBtn.Position = UDim2.new(0, 160, 0, 360)-- di bawah tombol trade / log
dumpBtn.BackgroundColor3 = Color3.fromRGB(47, 136, 106)
dumpBtn.TextColor3 = Color3.new(1,1,1)
dumpBtn.Font = Enum.Font.RobotoMono
dumpBtn.TextSize = 16
dumpBtn.Parent = rightFrame

local printBtn = Instance.new("TextButton")
printBtn.Text = "Print"
printBtn.Size = UDim2.new(0, 80, 0, 25)
printBtn.Position = UDim2.new(0, 250, 0, 360)-- di bawah tombol trade / log
printBtn.BackgroundColor3 = Color3.fromRGB(148, 148, 148)
printBtn.TextColor3 = Color3.new(0, 0, 0)
printBtn.Font = Enum.Font.RobotoMono
printBtn.TextSize = 16
printBtn.Parent = rightFrame

local SendMaster = Instance.new("TextButton")
SendMaster.Text = "Send"
SendMaster.Size = UDim2.new(0, 80, 0, 25)
SendMaster.Position = UDim2.new(0, 70, 0, 360) -- di bawah tombol trade / log
SendMaster.BackgroundColor3 = Color3.fromRGB(167, 28, 167)
SendMaster.TextColor3 = Color3.new(1,1,1)
SendMaster.Font = Enum.Font.RobotoMono
SendMaster.TextSize = 16
SendMaster.Parent = rightFrame

local resetBtn = Instance.new("TextButton")
resetBtn.Text = "üßπ"
resetBtn.Size = UDim2.new(0, 40, 0, 25)
resetBtn.Position = UDim2.new(0, 290, 0, 120)
resetBtn.BackgroundColor3 = Color3.fromRGB(172, 172, 172)
resetBtn.TextColor3 = Color3.new(1,1,1)
resetBtn.Font = Enum.Font.RobotoMono
resetBtn.TextSize = 16
resetBtn.Parent = rightFrame

local Handshake = Instance.new("TextButton")
Handshake.Text = "Sync"
Handshake.Size = UDim2.new(0, 60, 0, 25)
Handshake.Position = UDim2.new(0, 0, 0, 360) -- di bawah tombol trade / log
Handshake.BackgroundColor3 = Color3.fromRGB(122, 190, 12)
Handshake.TextColor3 = Color3.new(1,1,1)
Handshake.Font = Enum.Font.RobotoMono
Handshake.TextSize = 16
Handshake.Parent = rightFrame


-- === LOG FRAME ===
local logFrame = Instance.new("ScrollingFrame")
logFrame.Size = UDim2.new(1, -10, 0, 150)
logFrame.Position = UDim2.new(0, 0, 0, 160)
logFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)

logFrame.ScrollBarThickness = 8
logFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
logFrame.Parent = rightFrame
logFrame.BackgroundTransparency = 0.3
local logLayout = Instance.new("UIListLayout")
logLayout.Parent = logFrame
logLayout.SortOrder = Enum.SortOrder.LayoutOrder

logLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
	logFrame.CanvasSize = UDim2.new(0, 0, 0, logLayout.AbsoluteContentSize.Y)
	logFrame.CanvasPosition = Vector2.new(0, logFrame.CanvasSize.Y.Offset)
end)

local detail_harga = Instance.new("TextLabel")
detail_harga.Text = "detail"
detail_harga.Size = UDim2.new(0, 0, 0, 0)
detail_harga.Position = UDim2.new(0, 240, 0, 320)
detail_harga.TextColor3 = Color3.new(0, 0, 0)
detail_harga.Font = Enum.Font.RobotoMono
detail_harga.TextSize = 16
detail_harga.Parent = rightFrame

-- === Fungsi Cetak Log ===
local function cetak(teks)
	local logLine = Instance.new("TextLabel")
	logLine.Size = UDim2.new(1, 15, 0, 15)
	logLine.BackgroundTransparency = 1
	logLine.Text = tostring(teks)
	logLine.TextSize = 16
	logLine.TextColor3 = Color3.fromRGB(19, 19, 19)
	logLine.Font = Enum.Font.RobotoMono
	logLine.TextXAlignment = Enum.TextXAlignment.Left
	logLine.Parent = logFrame

    resetBtn.MouseButton1Click:Connect(function()
        --simpan_transaksi(0)
        logLine:Destroy()
        detail_harga.Text = "Reset"
    end)
end

local function list_variant(childName)
    -- Cek apakah children dengan nama tersebut ada
    print("cek variant ", childName)
    local child = Variants:FindFirstChild(childName)
    if not child then
        return nil
    end

    -- Jalankan ModuleScript dan ambil datanya
    local success, data = pcall(require, child)
    if not success then
        warn("Gagal memuat module untuk " .. childName .. ": " .. tostring(data))
        return nil
    end

    return data
end

----------------------------------------------------
---fungsi 
local running_time = "00:00:00"
local renderEnabled = false
local function render()
    renderEnabled = not renderEnabled
    if renderEnabled == true then
        setfpscap(5)
        RunService:Set3dRenderingEnabled(false)
    else
        RunService:Set3dRenderingEnabled(true)
        setfpscap(15)
    end
end
local auto_collect = nil
-- === SETTING AUTO TRADE ===
local HttpService = game:GetService("HttpService")
local settingsFile = "settings.json"
local settings = { auto_trade = false }
local total_transaksi = nil
-- Load settings dari file
local function loadSettings()
    if isfile and isfile(settingsFile) then
        local data = readfile(settingsFile)
        local decoded = HttpService:JSONDecode(data)
        if decoded then
            settings = decoded
            auto_collect = settings.auto_trade
            total_transaksi = settings.total_transaksi
            if total_transaksi == nil then
                total_transaksi = 0
                detail_harga.Text = "no load"
            end
        end
    else
        cetak("No settings file found, using default.")
    end
end
loadSettings()
-- Simpan settings ke file
local function saveSettings()
    if writefile then
        local data = HttpService:JSONEncode(settings)
        writefile(settingsFile, data)
    else
        cetak("‚ùå writefile() not supported in this environment.")
    end
end

-- === Tambahan fitur: simpan jumlah transaksi ===

-- Fungsi untuk menyimpan jumlah transaksi
local function simpan_transaksi(nilai)
    if type(nilai) ~= "number" then
        cetak("‚ùå Nilai transaksi harus berupa angka!")
        return
    end
    settings.total_transaksi = nilai
    saveSettings()
end

local list_ikan = {}
for _, child in pairs(ReplicatedStorage:WaitForChild("Items"):GetChildren()) do
    if child:IsA("ModuleScript") then
        local success, data = pcall(require, child)
        if success and data.Data.Type == "Fish" then
            list_ikan[data.Data.Id] = {
                harga = data.SellPrice,
                tier = data.Data.Tier,
                nama = data.Data.Name,
                id = data.Data.Id
            }
        end
    end
end

local function round(num, numDecimalPlaces)
	local mult = 10^(numDecimalPlaces or 0)
	return math.floor(num * mult + 0.5) / mult
end
local function konvert_harga(h)
    if h then
        local result
        local kk
        if h < 999 then
            result = tostring(h)
        elseif h < 1000000 then
            kk = h / 1000
            result = tostring(round(kk, 2)) .. " K"
        else
            kk = h / 1000000
            result = tostring(round(kk, 2)) .. " M"
        end
        return result
    end
end

local function get_tier(tier)
    if tier == 6 then 
        return "MYTHIC" 
    elseif tier == 7 then
        return "SECRET"
    end
end

local function teleport(x, y, z)
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart")
    if root then
        root.CFrame = CFrame.new(Vector3.new(x, y, z))
        print("‚úÖeleported to", x, y, z)
    end
end

local function getPositionByName(name)
    local plr = Players:FindFirstChild(name)
    if not plr then return nil, "player not found" end

    local char = plr.Character or plr.CharacterAdded:Wait()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil, "HumanoidRootPart not found" end

    return hrp.Position
end
local function SetLowGraphics()
    local Lighting = game:GetService("Lighting")
    local Terrain = workspace:FindFirstChildOfClass("Terrain")
    local MaterialService = game:GetService("MaterialService")
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
    Lighting.GlobalShadows = false
    Lighting.Brightness = 1
    Lighting.EnvironmentDiffuseScale = 0
    Lighting.EnvironmentSpecularScale = 0
    for _, effect in ipairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect.Enabled = false
        end
    end
    if Terrain then
        Terrain.WaterWaveSize = 0
        Terrain.WaterWaveSpeed = 0
        Terrain.WaterReflectance = 0
        Terrain.WaterTransparency = 1
    end
    MaterialService.Use2022Materials = false
end
local data = Client:WaitReplion("Data")

-- ambil inventory pertama kali
local function getInventory()
    return data:GetExpect({"Inventory"})
end

local function tentukan_berat(tabel_harga, nilai)
    for nama, range in pairs(tabel_harga) do
        if nilai >= range.Min and nilai <= range.Max then
            return nama 
        end
    end
    return "tidak diketahui"
end

local list_mitik = {}
local list_mitik_map = {}
local list_sekret = {}
local list_sekret_map = {}
local list_all = {}
local list_master = {}
local total_semua = 0
local hitung_ikan = 0
local total_secret = 0
local total_mitik = 0
local total_mutasi = 0
--// ANCHOR update_inventory

local function update_inventory()
     list_mitik = {}
     list_sekret = {}
     list_mitik_map = {}
     list_all = {}
     list_master = {}
     total_semua = 0
     hitung_ikan = 0
     total_secret = 0
     total_mitik = 0
     total_mutasi = 0
     local hitung_mitik_dic = 0
     local hitung_sekret_dic = 0
    local inventory = getInventory()
    for category, items in pairs(inventory) do
        if category == "Items" then
            for i, item in ipairs(items) do
                
                local itemData = ItemUtility:GetItemData(item.Id)
                    or ItemUtility:GetBaitData(item.Id)
                    or ItemUtility:GetPotionData(item.Id)

                local tierName = "None"
                if itemData and itemData.Data and itemData.Data.Tier then
                    local tierData = TierUtility:GetTier(itemData.Data.Tier)
                    if tierData and tierData.Name then
                        tierName = string.gsub(tierData.Name, "%s+", "")
                    end
                end
                local berat = item.Metadata and item.Metadata.Weight or 0
                local variant = item.Metadata and item.Metadata.VariantId or nil
                local custom_harga = 0
                local category_harga = ""
                local shiny = ""
                local mutasiName = ""
                
                if itemData.Data.Type == "Fish" and itemData.SellPrice then
                    custom_harga = itemData.SellPrice
                    
                    category_harga = ""
                    if berat > itemData.Weight.Default.Max then
                        category_harga = "*BIG*"
                        local multiplication_big = (berat - itemData.Weight.Default.Max) / (itemData.Weight.Big.Max - itemData.Weight.Default.Max)
                        print(multiplication_big)
                        custom_harga =  custom_harga * ( 1 + multiplication_big)
                    else
                        category_harga = ""
                    end
                    if item.Metadata.Shiny == true then
                        custom_harga = custom_harga + (custom_harga * 1.5)
                        shiny = "*SHINY*"
                    end
                    if variant then
                        local info_variant = list_variant(variant)
                        if info_variant then
                            mutasiName = "-->" .. info_variant.Data.Name .."(" .. info_variant.SellMultiplier .."x)"
                            if item.Metadata.Shiny == true then
                                custom_harga = custom_harga + (custom_harga * info_variant.SellMultiplier * 1.5)
                            else
                                custom_harga = custom_harga + (custom_harga * info_variant.SellMultiplier)
                            end
                        end
                    end
                    total_semua = total_semua + custom_harga
                    hitung_ikan = hitung_ikan + 1
                    table.insert(list_all, {nama = itemData.Data.Name, id = item.Id, uuid = tostring(item.UUID), harga = custom_harga, berat = tostring(berat),mutasi = variant})
                    if tierName == "SECRET" and berat < berat_min then
                        total_secret = total_secret + custom_harga
                        table.insert(list_sekret, {nama = itemData.Data.Name, id = item.Id, uuid = tostring(item.UUID), harga = custom_harga, berat = tostring(berat)})
                        list_sekret_map[hitung_sekret_dic] =  {nama = itemData.Data.Name, id = item.Id, uuid = tostring(item.UUID), harga = custom_harga, berat = tostring(berat)}
                        hitung_sekret_dic = hitung_sekret_dic + 1
                    end
                    if tierName == "Mythic" and variant == nil then
                        total_mitik = total_mitik + custom_harga
                        table.insert(list_mitik, {nama = itemData.Data.Name, id = item.Id, uuid = tostring(item.UUID), harga = custom_harga, berat = tostring(berat), mutasi = variant})
                        list_mitik_map[hitung_mitik_dic] = {nama = itemData.Data.Name, id = item.Id, uuid = tostring(item.UUID), harga = custom_harga, berat = tostring(berat), mutasi = variant}
                        hitung_mitik_dic = hitung_mitik_dic + 1
                    end
                    if variant or tierName == "SECRET" then
                        table.insert(list_master, {nama = itemData.Data.Name, id = item.Id, uuid = tostring(item.UUID), harga = custom_harga, berat = tostring(berat),mutasi = variant})
                    end
                    if variant then
                        total_mutasi = total_mutasi + 1
                    end
                    if dump_inventory == true then
                        local namas = i .. ". " ..mutasiName.. category_harga .." ".. shiny .. itemData.Data.Name .. " |$ " .. konvert_harga(custom_harga)
                        cetak(namas)
                    end
                end
            end
        end
    end
    local waktu = os.date("*t") -- ambil waktu lokal
    local cetak = "Total : ".. konvert_harga(total_semua) .. " | " .. konvert_harga(hitung_ikan) .. " Ikan \n"
    .. "Secret : ".. konvert_harga(total_secret) .. " | " .. #list_sekret_map .. " Ikan \n"
    .. "Mitik : ".. konvert_harga(total_mitik) .." | " .. #list_mitik_map .. " Ikan \n"
    .. "Mutasi: " .. total_mutasi .. " Ikan \n"
    statsLabel.Text = cetak
end

local function send_handshake(user)
    print(user)
    local uuid = "0c0130a7-4a59-4747-972a-d7b7bd63bfa2"
    Net:WaitForChild("RE/EquipItem"):FireServer(uuid, "Fishes")
    task.wait(1)
    Net:WaitForChild("RF/InitiateTrade"):InvokeServer(user, uuid)
end

reloadBtn.MouseButton1Click:Connect(function()
    update_inventory()
end)
-- === PLAYER MANAGEMENT ===
local selectedPlayer = nil

local function createPlayerButton(name)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -10, 0, 30)
	btn.BackgroundColor3 = Color3.fromRGB(70, 100, 150)
	btn.Text = name
	btn.TextColor3 = Color3.new(1,1,1)
	btn.Font = Enum.Font.RobotoMono
	btn.TextSize = 16
	btn.Parent = listScroll

	btn.MouseButton1Click:Connect(function()
		if selectedPlayer == name then
			selectedPlayer = nil
			btn.BackgroundColor3 = Color3.fromRGB(70, 100, 150)
			selectedLabel.Text = "Selected Player: -"
		else
			selectedPlayer = name
			selectedLabel.Text = "Selected Player: " .. name
			btn.BackgroundColor3 = Color3.fromRGB(200, 80, 80)
			cetak("Selected: " .. name)
            local pos, err = getPositionByName(name)
            if pos then
                print("Posisi sekarang:", pos)
                local x = pos.X
                local y = pos.Y
                local z = pos.Z
                teleport(x,y,z)
                task.wait(5)
            end
		end
	end)
end

for _, p in ipairs(Players:GetPlayers()) do
	if p ~= player then
		createPlayerButton(p.Name)
	end
end

Players.PlayerAdded:Connect(function(p)
	if p ~= player then
		createPlayerButton(p.Name)
		cetak(p.Name .. " joined")
	end
end)

Players.PlayerRemoving:Connect(function(p)
	for _, btn in ipairs(listScroll:GetChildren()) do
		if btn:IsA("TextButton") and btn.Text == p.Name then
			btn:Destroy()
		end
	end
	if selectedPlayer == p.Name then
		selectedPlayer = nil
		selectedLabel.Text = "Selected Player: -"
	end
	cetak(p.Name .. " left")
end)

--//ANCHOR - Trade
local function trade(target, jumlah, type)
    startscript = tick()
    start_timer = true
	cetak("Trade ke " .. target .. " sejumlah " .. jumlah)
    local completed = false
    Net:WaitForChild("RE/TextNotification").OnClientEvent:Connect(
        function(data)
            print("ADA NOTIF: ", data.Text)
            if data and data.Text == "Trade completed!" then
                completed = true
            end
        end
    )
    local pos, err = getPositionByName(target)
    if pos then
        print("Posisi sekarang:", pos)
        local x = pos.X
        local y = pos.Y
        local z = pos.Z
        teleport(x,y,z)
        task.wait(5)
    end

    update_inventory()
    local custom_list = nil
    local flag_secret = false
    if type then
        if type == "master" then
            if target ~= "hayfish96" then
                cetak("master tidak sesuai")
                return
            end
            custom_list = list_master
        elseif type == "secret" then
            cetak("trade sekret dipilih")
            custom_list = list_sekret
            flag_secret = true
        elseif type == "mitik" then
            cetak("trade mitik dipilih")
            custom_list = list_mitik
        else
            cetak("trade all dipilih")
            custom_list = list_all
        end
    end
    
    local berhasil = 0
    local info_akhir = ""
    local current_harga = 0

    if flag_secret == false and (jumlah > 0 and total_semua < round(jumlah / 1000000,2)) then
        cetak("!! total ikan tidak memenuhi target !!")
        return
    end
    if total_transaksi ~= nil and total_transaksi ~= 0 then
        current_harga = total_transaksi
        cetak("load transaksi akhir: " .. tostring(current_harga))
    end
    local function trade_user(usr)
        print("Player ditemukan:", usr.Name, "UserId:", usr.UserId)
        local list_trade_array = {}
        if custom_list ~= nil then
            for i, info in ipairs(custom_list) do
                Net:WaitForChild("RE/EquipItem"):FireServer(info.uuid, "Fishes")
                Net:WaitForChild("RF/InitiateTrade"):InvokeServer(usr.UserId, info.uuid)
                local timeout = 0
                while completed ~= true do
                    timeout = timeout + 1
                    if timeout > 20 then
                        print("timeout")
                        break
                    end
                    task.wait(0.4)
                end
                if timeout < 20 then
                    berhasil = berhasil + 1
                    info_akhir = "Total: " .. berhasil .. "/" .. jumlah
                    current_harga = current_harga  + info.harga
                    local current_mutasi = info.mutasi or "-"
                    local info_ikan = berhasil ..". " .. info.nama .. " (" .. info.berat .. " kg) " .. current_mutasi
                    cetak(info_ikan)
                    detail_harga.Text = info_akhir .." | $ ".. konvert_harga(current_harga)
                    --simpan_transaksi(current_harga)
                end
                completed = false
                local mm = current_harga / 1000000
                local limit = round(mm, 2)
                if flag_secret == true then
                    if berhasil >= jumlah then
                        cetak("total transaksi tercapai: " .. tostring(jumlah))
                        break
                    end
                else
                    if jumlah > 0 and limit > jumlah then
                        cetak("jumlah tercapai : " .. round(current_harga,2))
                        break
                    end
                end
                if trade_stop == true then
                    cetak("! TRADE STOPED !")
                    break
                end
            end
            task.wait(5)
        else
            cetak("tidak ada barang lagi")
        end
        cetak("SELESAI SEMUA " .. info_akhir)
        start_timer = false
        update_inventory()
    end
    local existing = Players:FindFirstChild(target)
    if existing then
        trade_user(existing)
    else
        cetak("player tidak ada")
    end
end
--//ANCHOR trade map
local function trade_map(target, jumlah, type)
    local completed = false
    startscript = tick()
    start_timer = true
    Net:WaitForChild("RE/TextNotification").OnClientEvent:Connect(
        function(data)
            print("ADA NOTIF: ", data.Text)
            if data and data.Text == "Trade completed!" then
                completed = true
            end
        end
    )
    local pos, err = getPositionByName(target)
    if pos then
        print("Posisi sekarang:", pos)
        local x = pos.X
        local y = pos.Y
        local z = pos.Z
        teleport(x,y,z)
        task.wait(5)
    end

    update_inventory()
    local custom_list = nil
    local flag_secret = false
    if type then
        if type == "master" then
            if target ~= "hayfish96" then
                cetak("master tidak sesuai")
                return
            end
            custom_list = list_master
        elseif type == "secret" then
            cetak("Trade sekret  ke " .. target .. " sejumlah " .. jumlah)
            printer = printer .. "\n Trade sekret  ke " .. target .. " sejumlah " .. jumlah
            custom_list = list_sekret_map
            flag_secret = true
        elseif type == "mitik" then
            cetak("Trade mitik  ke " .. target .. " sejumlah " .. jumlah .." M")
            printer = printer .. "\n Trade sekret  ke " .. target .. " sejumlah " .. jumlah .. " Coin"
            custom_list = list_mitik_map
        else
            cetak("trade all dipilih")
            custom_list = list_mitik_map
        end
    end
    
    local berhasil = 0
    local info_akhir = ""
    local current_harga = 0

    local function trade_user(usr)
        print("Player ditemukan:", usr.Name, "UserId:", usr.UserId)
        if custom_list ~= nil then
            local map_i = 0
            local info
            while true do
                info = custom_list[map_i]
                if info == nil then
                    cetak("ikan sudah habis")
                    break
                end
                Net:WaitForChild("RE/EquipItem"):FireServer(info.uuid, "Fishes")
                Net:WaitForChild("RF/InitiateTrade"):InvokeServer(usr.UserId, info.uuid)
                local timeout = 0
                while completed ~= true do
                    print("wait")
                    timeout = timeout + 1
                    if timeout > 30 then
                        print("timeout lebih dari 15 detik")
                        break
                    end
                    task.wait(0.4)
                end
                if timeout < 30 then
                    berhasil = berhasil + 1
                    map_i = map_i + 1
                    info_akhir = "Total: " .. berhasil .. "/" .. jumlah
                    current_harga = current_harga  + info.harga
                    local current_mutasi = info.mutasi or "-"
                    local info_ikan = berhasil ..". " .. info.nama .. " (" .. info.berat .. " kg) " .. current_mutasi
                    cetak(info_ikan)
                    detail_harga.Text = info_akhir .." | $ ".. konvert_harga(current_harga)
                    printer = printer .. "\n".. info_ikan
                    simpan_transaksi(current_harga)
                end
                completed = false
                local mm = current_harga / 1000000
                local limit = round(mm, 2)
                if flag_secret == true then
                    if berhasil >= jumlah then
                        cetak("total transaksi tercapai: " .. tostring(jumlah))
                        break
                    end
                else
                    if jumlah > 0 and limit > jumlah then
                        cetak("jumlah tercapai ! " .. current_harga)
                        break
                    end
                end
                if trade_stop == true then
                    cetak("! TRADE STOPED !")
                    break
                end
                start_timer = false
                task.wait(5)
            end
        else
            cetak("tidak ada barang lagi")
        end
        cetak("SELESAI SEMUA " .. info_akhir)
        update_inventory()
    end
    local existing = Players:FindFirstChild(target)
    if existing then
        trade_user(existing)
    else
        cetak("player tidak ada")
    end
end

tradeBtn.MouseButton1Click:Connect(function()
	if not selectedPlayer then
		cetak("‚ùå Pilih player dulu!")
		return
	end
	local jumlah = tonumber(amountBox.Text)
	if not jumlah or jumlah <= 0 then
		cetak("‚ùå Masukkan jumlah valid!")
		return
	end
	trade_map(selectedPlayer, jumlah, "mitik")
end)

tradeSecret.MouseButton1Click:Connect(function()
	if not selectedPlayer then
		cetak("‚ùå Pilih player dulu!")
		return
	end
	local jumlah = tonumber(amountBox.Text)
	if not jumlah or jumlah <= 0 then
		cetak("‚ùå Masukkan jumlah valid!")
		return
	end
	trade_map(selectedPlayer, jumlah, "secret")
end)

allBtn.MouseButton1Click:Connect(function()
	if not selectedPlayer then
		cetak("‚ùå Pilih player dulu!")
		return
	end
	trade_map(selectedPlayer, 0, "all")
end)
SendMaster.MouseButton1Click:Connect(function()
	if not selectedPlayer then
		cetak("‚ùå Pilih player dulu!")
		return
	end
	trade(selectedPlayer, 0, "master")
end)
stopBtn.MouseButton1Click:Connect(function()
	trade_stop = not trade_stop
    if trade_stop then
        stopBtn.BackgroundColor3 = Color3.fromRGB(109, 0, 0)
        cetak("trade stopped ON")
    else
        stopBtn.BackgroundColor3 = Color3.fromRGB(243, 6, 6)
        cetak("trade stopped OFF")
    end
end)


-- Klik toggle


local function updateButton()
	if settings.auto_trade then
		settingBtn.Text = "Collect: ON"
		settingBtn.BackgroundColor3 = Color3.fromRGB(74, 158, 74)
	else
		settingBtn.Text = "Collect: OFF"
		settingBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
	end
end

-- Klik toggle
settingBtn.MouseButton1Click:Connect(function()
	settings.auto_trade = not settings.auto_trade
	updateButton()
	saveSettings()
end)

renderBtn.MouseButton1Click:Connect(function()
    render()
end)
dumpBtn.MouseButton1Click:Connect(function()
    dump_inventory = true
    update_inventory()
end)
printBtn.MouseButton1Click:Connect(function()
    if setclipboard then
        setclipboard(printer)
        task.wait(1.5)
        cetak("berhasil copy to clipboard")
    else
        pesan("gagal copy ")
    end
end)
    -- === Jalankan load saat awal ===
updateButton()
-- Tes awal
cetak("Collector GUI loaded.")
if total_transaksi and total_transaksi ~= 0 then
    detail_harga.Text = "Load Trade: " .. konvert_harga(total_transaksi)
end
local total_ikan = 1
local total_batu = 1
RF.OnClientInvoke = function(...)
    local args = {...}
    local data = args[2]
    if type(data) == "table" then
        print("Trade offer:", data.Id, data.UUID)
    end
    local detail = ""
    if data.Id == 10 then
        detail = total_batu .. ". GET ENCHANT STONE"
        total_batu = total_batu + 1
    elseif list_ikan[data.Id] then
        detail = total_ikan .. ". [ ".. get_tier(list_ikan[data.Id].tier) .." ] " .. list_ikan[data.Id].nama
        total_ikan = total_ikan + 1
    end
    update_inventory()
    cetak(detail)
    task.wait(3)
    return "OK"
end
update_inventory()
local function auto_collecting()
        cetak("start auto collect")
        local ready = true
        if #Players:GetPlayers() > 2 then
            cetak("PLAYER LEBIH DARI 1")
            ready = false
        end
        if ready then
            local nama = nil
            for i, user in ipairs(Players:GetPlayers()) do
                if user ~= player then
                    nama = user.Name
                end
            end
            if nama then
                local pos, err = getPositionByName(nama)
                if pos then
                    print("Posisi sekarang:", pos)
                    local x = pos.X
                    local y = pos.Y
                    local z = pos.Z
                    teleport(x,y,z)
                    task.wait(5)
                    local existing = Players:FindFirstChild(nama)
                    if existing then
                        cetak("kirim handshake")
                        send_handshake(existing.UserId)
                    else
                        print("player tidak ada")
                    end
                end
            end
        end
end

Handshake.MouseButton1Click:Connect(function()
	auto_collecting()
end)

local function attachSmartPlatform()
    -- Buat platform sekali
    local platform = Instance.new("Part")
    platform.Name = "LocalPlatform"
    platform.Size = Vector3.new(6, 0.2, 6)
    platform.Anchored = true
    platform.CanCollide = true
    platform.Transparency = 0.3
    platform.Color = Color3.new(1, 0, 0)
    platform.Parent = workspace

    -- Update posisi hanya ketika karakter bergerak
    local function updatePlatform()
        platform.CFrame = CFrame.new(root.Position.X, root.Position.Y - 3, root.Position.Z)
    end
    updatePlatform()
    root:GetPropertyChangedSignal("Position"):Connect(updatePlatform)
end
if auto_collect then
    render()
    player.CharacterAdded:Connect(attachSmartPlatform)
    if player.Character then
        attachSmartPlatform()
    end
    auto_collecting()
end
local total_trade = 0
Net:WaitForChild("RE/TextNotification").OnClientEvent:Connect(
    function(data)
        if data and data.Text == "Trade completed!" then
            total_trade = total_trade + 1
            local info = "trade : " .. tostring(total_trade)
            --simpan_transaksi(total_trade)
            detail_harga.Text = info
        end
    end
)
local function formatTime(seconds)
    local h = math.floor(seconds / 3600)
    local m = math.floor((seconds % 3600) / 60)
    local s = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", h, m, s)
end
--SetLowGraphics()
while running do
    if start_timer then
        running_time = formatTime(math.floor(tick() - startscript))
        selectedLabel.Text = running_time
        task.wait(1)
    else
        task.wait(50)
    end
end
