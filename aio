versi = "AIO V1.5.0"
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local player = Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui")
local character = player.Character or player.CharacterAdded:Wait()
local root = character:WaitForChild("HumanoidRootPart")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Net =
    ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild(
    "net"
)
local HttpService = game:GetService("HttpService")
local koin = gui:WaitForChild("Events").Frame.CurrencyCounter.Counter.Text

local ok, Replion = pcall(function() return require(ReplicatedStorage.Packages.Replion) end)
if not ok or not Replion.Client then
    warn("Replion client tidak ditemukan")
    return
end

local PLATFORM_SIZE = Vector3.new(6, 0.2, 6)
local OFFSET = -3
--GLOBAL VARIABLE
local startscript = tick()
local running = true
local spawning = true
local total_harga = 0
local list_inventory_rod = {}
local list_inventory_fishs = {}
local fish_caught = false
local count_mancing = 0
local step = 0
local flag_auto_buy = true
local progress_quest1 = 0
local progress_quest2 = 0
local progress_quest3 = 0
local progress_quest4 = 0
local list_secret = {}
local list_trade = {}
local list_mythic = {}

local  url = "https://raw.githubusercontent.com/onekiki/JHASKDJHASDWQE/refs/heads/main/quest.json"
local WEBHOOK_URL = "https://discord.com/api/webhooks/1425376677982113832/ZjsQSZk6JZWWVQ63tdyF3Gcdz1li088TA39bAZfB5sBQj8fB-vYvMv4A7_8m21ZiCWtc"


local select_quest = nil
local master_user = "hayfish96"

-- === ScreenGui utama ===
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "HAYBOT"
screenGui.Parent = gui

-- === Frame utama (container) ===
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(1, 0, 1, 100)
mainFrame.Position = UDim2.new(0, 0, 0, -100)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BorderSizePixel = 0
mainFrame.BackgroundTransparency = 0
mainFrame.Visible = true
mainFrame.Parent = screenGui

local listContainer = Instance.new("Frame")
listContainer.Name = "ListContainer"
listContainer.Position = UDim2.new(0.75, 0, 0.4, 0)
listContainer.Size = UDim2.new(1, 0, 1, -35)
listContainer.BackgroundTransparency = 1
listContainer.Parent = mainFrame

-- Tambahkan UIListLayout agar otomatis ke bawah
local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 5)
listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Parent = listContainer

local text_jam = Instance.new("TextLabel")
text_jam.Size = UDim2.new(0, 0, 0, 0)
text_jam.Position = UDim2.new(0.9, 0, 0, 120)
text_jam.Text = "00:00:00"
text_jam.Font = Enum.Font.RobotoMono
text_jam.TextSize = 46
text_jam.TextXAlignment = Enum.TextXAlignment.Center
text_jam.TextColor3 = Color3.fromRGB(230, 255, 1)
text_jam.Parent = mainFrame

local text_secret = Instance.new("TextLabel")
text_secret.Size = UDim2.new(0, 0, 0, 0)
text_secret.Position = UDim2.new(0.7, 0, 0.2, 15)
text_secret.Text = "Secret:"
text_secret.Font = Enum.Font.Roboto
text_secret.TextSize = 30
text_secret.TextXAlignment = Enum.TextXAlignment.Center
text_secret.TextColor3 = Color3.fromRGB(79, 161, 175)
text_secret.Parent = mainFrame

local text_myth = Instance.new("TextLabel")
text_myth.Size = UDim2.new(0, 0, 0, 0)
text_myth.Position = UDim2.new(0.9, 0, 0.2, 15)
text_myth.Text = "Mythic:"
text_myth.Font = Enum.Font.Roboto
text_myth.TextSize = 30
text_myth.TextXAlignment = Enum.TextXAlignment.Center
text_myth.TextColor3 = Color3.fromRGB(79, 161, 175)
text_myth.Parent = mainFrame

local total_secret = Instance.new("TextLabel")
total_secret.Size = UDim2.new(0, 0, 0, 0)
total_secret.Position = UDim2.new(0.7, 0, 0.2, 80)
total_secret.Text = "$ "
total_secret.Font = Enum.Font.Roboto
total_secret.TextSize = 60
total_secret.TextXAlignment = Enum.TextXAlignment.Center
total_secret.TextColor3 = Color3.fromRGB(144, 156, 158)
total_secret.Parent = mainFrame

local total_mythic = Instance.new("TextLabel")
total_mythic.Size = UDim2.new(0, 0, 0, 0)
total_mythic.Position = UDim2.new(0.9, 0, 0.2, 80)
total_mythic.Text = "$"
total_mythic.Font = Enum.Font.Roboto
total_mythic.TextSize = 60
total_mythic.TextXAlignment = Enum.TextXAlignment.Center
total_mythic.TextColor3 = Color3.fromRGB(144, 156, 158)
total_mythic.Parent = mainFrame

local text_quest_master = Instance.new("TextLabel")
text_quest_master.Size = UDim2.new(0, 0, 0, 0)
text_quest_master.Position = UDim2.new(0, 20, 0.45, 0)
text_quest_master.Text = "JUNGLE QUEST:"
text_quest_master.Font = Enum.Font.Roboto
text_quest_master.TextSize = 30
text_quest_master.TextXAlignment = Enum.TextXAlignment.Left
text_quest_master.TextColor3 = Color3.fromRGB(76, 138, 74)
text_quest_master.Parent = mainFrame

local text_quest_1 = Instance.new("TextLabel")
text_quest_1.Size = UDim2.new(0, 0, 0, 0)
text_quest_1.Position = UDim2.new(0, 20, 0.45, 35)
text_quest_1.Text = "QUEST 1"
text_quest_1.Font = Enum.Font.Roboto
text_quest_1.TextSize = 30
text_quest_1.TextXAlignment = Enum.TextXAlignment.Left
text_quest_1.TextColor3 = Color3.fromRGB(142, 156, 142)
text_quest_1.Parent = mainFrame

local text_quest_2 = Instance.new("TextLabel")
text_quest_2.Size = UDim2.new(0, 0, 0, 0)
text_quest_2.Position = UDim2.new(0, 20, 0.45, 70)
text_quest_2.Text = "QUEST 1"
text_quest_2.Font = Enum.Font.Roboto
text_quest_2.TextSize = 30
text_quest_2.TextXAlignment = Enum.TextXAlignment.Left
text_quest_2.TextColor3 = Color3.fromRGB(142, 156, 142)
text_quest_2.Parent = mainFrame

local text_quest_3 = Instance.new("TextLabel")
text_quest_3.Size = UDim2.new(0, 0, 0, 0)
text_quest_3.Position = UDim2.new(0, 20, 0.45, 105)
text_quest_3.Text = "QUEST 1"
text_quest_3.Font = Enum.Font.Roboto
text_quest_3.TextSize = 30
text_quest_3.TextXAlignment = Enum.TextXAlignment.Left
text_quest_3.TextColor3 = Color3.fromRGB(142, 156, 142)
text_quest_3.Parent = mainFrame

local text_quest_4 = Instance.new("TextLabel")
text_quest_4.Size = UDim2.new(0, 0, 0, 0)
text_quest_4.Position = UDim2.new(0, 20, 0.45, 140)
text_quest_4.Text = "QUEST 1"
text_quest_4.Font = Enum.Font.Roboto
text_quest_4.TextSize = 30
text_quest_4.TextXAlignment = Enum.TextXAlignment.Left
text_quest_4.TextColor3 = Color3.fromRGB(142, 156, 142)
text_quest_4.Parent = mainFrame

local text_lokasi = Instance.new("TextLabel")
text_lokasi.Size = UDim2.new(0, 0, 0, 0)
text_lokasi.Position = UDim2.new(0, 20, 0.95, 0)
text_lokasi.Text = "Lokasi"
text_lokasi.Font = Enum.Font.Roboto
text_lokasi.TextSize = 40
text_lokasi.TextXAlignment = Enum.TextXAlignment.Left
text_lokasi.TextColor3 = Color3.fromRGB(141, 141, 141)
text_lokasi.Parent = mainFrame

local text_quest = Instance.new("TextLabel")
text_quest.Size = UDim2.new(0, 0, 0, 0)
text_quest.Position = UDim2.new(0.5, 0, 0.8, 50)
text_quest.Text = "QUEST KUNTUL"
text_quest.Font = Enum.Font.Roboto
text_quest.TextSize = 34
text_quest.TextXAlignment = Enum.TextXAlignment.Center
text_quest.TextColor3 = Color3.fromRGB(105, 105, 105)
text_quest.Parent = mainFrame

local text_coin = Instance.new("TextLabel")
text_coin.Size = UDim2.new(0, 0, 0, 0)
text_coin.Position = UDim2.new(0.2, 0, 0.3, 0)
text_coin.Text = "0"
text_coin.Font = Enum.Font.RobotoMono
text_coin.TextSize = 80
text_coin.TextXAlignment = Enum.TextXAlignment.Center
text_coin.TextColor3 = Color3.fromRGB(230, 255, 1)
text_coin.Parent = mainFrame

local text_versi = Instance.new("TextLabel")
text_versi.Size = UDim2.new(0, 0, 0, 0)
text_versi.Position = UDim2.new(0.5, 0, 0, 110)
text_versi.Text = "HAYBOT " .. versi
text_versi.Font = Enum.Font.RobotoMono
text_versi.TextSize = 28
text_versi.TextXAlignment = Enum.TextXAlignment.Center
text_versi.TextColor3 = Color3.fromRGB(255, 255, 255)
text_versi.Parent = mainFrame

local text_total = Instance.new("TextLabel")
text_total.Size = UDim2.new(0, 0, 0, 0)
text_total.Position = UDim2.new(0.5, 0, 0.4, 0)
text_total.Text = "123221"
text_total.Font = Enum.Font.Roboto
text_total.TextSize = 70
text_total.TextXAlignment = Enum.TextXAlignment.Center
text_total.TextColor3 = Color3.fromRGB(255, 217, 1)
text_total.Parent = mainFrame

local text_timer = Instance.new("TextLabel")
text_timer.Size = UDim2.new(0, 0, 0, 0)
text_timer.Position = UDim2.new(0.5, 0, 0.5, 0)
text_timer.Text = "IKAN KUNTUL"
text_timer.Font = Enum.Font.RobotoMono
text_timer.TextSize = 60
text_timer.TextXAlignment = Enum.TextXAlignment.Center
text_timer.TextColor3 = Color3.fromRGB(230, 255, 1)
text_timer.Parent = mainFrame

local text_nama = Instance.new("TextLabel")
text_nama.Size = UDim2.new(0, 0, 0, 0)
text_nama.Position = UDim2.new(0.5, 0, 0.1, 0)
text_nama.Text = player.Name
text_nama.Font = Enum.Font.RobotoMono
text_nama.TextSize = 50
text_nama.TextXAlignment = Enum.TextXAlignment.Center
text_nama.TextColor3 = Color3.fromRGB(255, 255, 255)
text_nama.Parent = mainFrame



local text_ikan = Instance.new("TextLabel")
text_ikan.Size = UDim2.new(0, 0, 0, 0)
text_ikan.Position = UDim2.new(0.5, 0, 0.75, 0)
text_ikan.Text = "- ! HAYBOT ! -"
text_ikan.Font = Enum.Font.Roboto
text_ikan.TextSize = 50
text_ikan.TextXAlignment = Enum.TextXAlignment.Center
text_ikan.TextColor3 = Color3.fromRGB(69, 180, 54)
text_ikan.Parent = mainFrame


local text_rod = Instance.new("TextLabel")
text_rod.Size = UDim2.new(0, 0, 0, 0)
text_rod.Position = UDim2.new(0.5, 0, 0.7, -30)
text_rod.Text = "ROD"
text_rod.Font = Enum.Font.Roboto
text_rod.TextSize = 38
text_rod.TextXAlignment = Enum.TextXAlignment.Center
text_rod.TextColor3 = Color3.fromRGB(160, 127, 155)
text_rod.Parent = mainFrame



local btn_reload = Instance.new("TextButton")
btn_reload.Size = UDim2.new(0, 40, 0, 40)
btn_reload.Position = UDim2.new(0, 60, 0, 100)
btn_reload.Text = "🔄"
btn_reload.TextScaled = true
btn_reload.Visible = true
btn_reload.TextXAlignment = Enum.TextXAlignment.Center
btn_reload.TextColor3 = Color3.fromRGB(255, 255, 255)
btn_reload.Parent = mainFrame
btn_reload.BackgroundColor3 = Color3.fromRGB(77, 77, 77)

local btn_trade = Instance.new("TextButton")
btn_trade.Size = UDim2.new(0, 150, 0, 40)
btn_trade.Position = UDim2.new(0, 160, 0, 100)
btn_trade.Text = "Trade"
btn_trade.TextScaled = true
btn_trade.Visible = true
btn_trade.TextXAlignment = Enum.TextXAlignment.Center
btn_trade.TextColor3 = Color3.fromRGB(255, 255, 255)
btn_trade.Parent = mainFrame
btn_trade.BackgroundColor3 = Color3.fromRGB(177, 107, 16)

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 40, 0, 40)
closeBtn.Position = UDim2.new(0, 10, 0, 100)
closeBtn.Text = "❌"
closeBtn.TextScaled = true
closeBtn.Visible = true
closeBtn.TextXAlignment = Enum.TextXAlignment.Center
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Parent = mainFrame

local btn_stop = Instance.new("TextButton")
btn_stop.Size = UDim2.new(0, 40, 0, 40)
btn_stop.Position = UDim2.new(0, 110, 0, 100)
btn_stop.Text = "⏹️"
btn_stop.TextScaled = true
btn_stop.Visible = true
btn_stop.TextXAlignment = Enum.TextXAlignment.Center
btn_stop.TextColor3 = Color3.fromRGB(255, 255, 255)
btn_stop.BackgroundColor3 = Color3.fromRGB(77, 77, 77)
btn_stop.Parent = mainFrame

local render_btn = Instance.new("TextButton")
render_btn.Size = UDim2.new(0, 40, 0, 40)
render_btn.Position = UDim2.new(0, 320, 0, 100)
render_btn.Text = "👁️"
render_btn.Visible = true
render_btn.TextScaled = true
render_btn.TextXAlignment = Enum.TextXAlignment.Center
render_btn.TextColor3 = Color3.fromRGB(255, 255, 255)
render_btn.Parent = mainFrame
----------------------------------------------------------------------------------
------------------- MAIN FUNGSI
----------------------------------------------------------------------------------
--[[
local list_items_id = {}
for _, child in pairs(ReplicatedStorage:WaitForChild("Items"):GetChildren()) do
    if child:IsA("ModuleScript") then
        local success, data = pcall(require, child)
        if success and data then
            list_items_id[data.Data.Id] = data
        end
    end
end
--]]

local placeId = game.PlaceId
local jobId = game.JobId 

local function rejoinSameServer()
    if not player then return end
    -- pcall supaya aman jika error
    local ok, err = pcall(function()
        TeleportService:TeleportToPlaceInstance(placeId, jobId, player)
    end)
    if not ok then
        warn("Rejoin gagal: "..tostring(err))
    end
end

local function cek_quest(text)
    if not text then return nil end
    local percent = string.match(text, "(%d+)%%") 
    if percent then
        return tonumber(percent)
    end
    return 0
end

local function convert(str)
    if string.find(str, "K") then
        local num = string.gsub(str, "K", "")
        return math.floor(num * 1000)
    end
    if string.find(str, "M") then
        local num = string.gsub(str, "M", "")
        return math.floor(num * 1000000)
    end
    return tonumber(str)
end

function round(num, numDecimalPlaces)
    local mult = 10 ^ (numDecimalPlaces or 0)
    return math.floor(num * mult + 0.5) / mult
end

local function discord(message)
    local headers = {
        ["Content-Type"] = "application/json"
    }
    local prefix = "[ " .. player.Name .. " ] > "
    local data = {
        ["content"] = prefix .. message
    }
    local body = HttpService:JSONEncode(data)
    local response = request({
        Url = WEBHOOK_URL,
        Method = "POST",
        Headers = headers,
        Body = body
    })
end

local function fav(uuid)
    Net:WaitForChild("RE/FavoriteItem"):FireServer(uuid)
    task.wait(1)
end

local function auto_buy_rod(id)
    print("beli rod id:", id)
    Net:WaitForChild("RF/PurchaseFishingRod"):InvokeServer(id)
end

local function auto_buy_bait(id)
    print("beli bait id:", id)
    Net:WaitForChild("RF/PurchaseBait"):InvokeServer(id)
    task.wait(1)
    Net:WaitForChild("RE/EquipBait"):FireServer(id)
end



local function konvert_harga(h)
    if h < 999 then
        result = tostring(h)
    elseif h < 1000000 then
        kk = h / 1000
        result = tostring(round(kk,2)) .. " K"
    else
        kk = h / 1000000
        result = tostring(round(kk,2)) .. " M"
    end
    return result
end

local list_ikan = {}
local list_rod = {}
for _, child in pairs(ReplicatedStorage:WaitForChild("Items"):GetChildren()) do
    if child:IsA("ModuleScript") then
        local success, data = pcall(require, child)
        if success and data.Data.Type == "Fishes" then
            list_ikan[data.Data.Id] = {
                harga = data.SellPrice,
                tier = data.Data.Tier,
                nama = data.Data.Name,
                id = data.Data.Id
            }
        end
        if success and string.find(data.Data.Name,"Rod") then
            list_rod[data.Data.Id] = {
                    tier = data.Data.Tier,
                    nama = data.Data.Name,
                    id = data.Data.Id
                }
        end
    end
end

local Event = Net:WaitForChild("RE/ObtainedNewFishNotification")
-- putuskan koneksi lama (opsional)
if getconnections then
    for _, conn in ipairs(getconnections(Event.OnClientEvent)) do
        conn:Disable()
    end
end

Event.OnClientEvent:Connect(function(itemId, stats, data, flag)
    if itemId == 265 or itemId== 266 or itemId == 267 or itemId == 271 then
        fav(data.InventoryItem.UUID)
    end
    if list_ikan[itemId].tier == 7 then
        local cetak = "[SECRET] " .. list_ikan[itemId].tier .. " > " .. list_ikan[itemId].nama
        discord(cetak)
    end
end)

local function onFishCaught(callback)
    local connection
    local remote = Net:WaitForChild("RE/FishCaught")
    if not connection then
        connection =
            remote.OnClientEvent:Connect(
            function(name, data)
                if running then
                    callback(name, data)
                end
            end
        )
    end
end
local lastCatchTime = nil

onFishCaught(
    function(name, data)
        local varian = ""
        if data.Variants then
            varian = "[" .. tostring(data.Variants) .. "] "
        end
        text_ikan.Text = varian .. name .. " (" .. round(data.Weight, 2) .. " Kg)"
        lastCatchTime = os.clock()
    end
)

local block_bait = Net:WaitForChild("RE/BaitSpawned")
--local block_text_effect = Net:WaitForChild("RE/ReplicateTextEffect")
--local block_effect = Net:WaitForChild("RE/PlayFishingEffect")
local function block(evn)
    if getconnections then
        for _, conn in ipairs(getconnections(evn.OnClientEvent)) do
            conn:Disable()
        end
    end
end
block(block_bait)

block_bait.OnClientEvent:Connect(function() end)
--block_text_effect.OnClientEvent:Connect(function() end)
--block_effect.OnClientEvent:Connect(function() end)
-----------------------------------------------------------------
-- teleport
-----------------------------------------------------------------

local function attachSmartPlatform(char)
    -- Buat platform sekali
    local platform = Instance.new("Part")
    platform.Name = "LocalPlatform"
    platform.Size = PLATFORM_SIZE
    platform.Anchored = true
    platform.CanCollide = true
    platform.Transparency = 0.3
    platform.Color = Color3.new(1, 0, 0)
    platform.Parent = workspace

    -- Update posisi hanya ketika karakter bergerak
    local function updatePlatform()
        platform.CFrame = CFrame.new(root.Position.X, root.Position.Y + OFFSET, root.Position.Z)
    end

    updatePlatform() -- set posisi awal

    root:GetPropertyChangedSignal("Position"):Connect(updatePlatform)

    -- Jika karakter mati / hilang
    char.AncestryChanged:Connect(
        function(_, parent)
            if not parent then
                if platform and platform.Parent then
                    platform:Destroy()
                end
            end
        end
    )
end

player.CharacterAdded:Connect(attachSmartPlatform)
if player.Character then
    attachSmartPlatform(player.Character)
end

local function teleport(x, y, z)
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart")
    if root then
        root.CFrame = CFrame.new(Vector3.new(x, y, z))
    end
end
local function face(yawDeg)
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart")
    if root then
        local pos = root.Position
        local yaw = math.rad(yawDeg) -- derajat ke radian
        local dir = Vector3.new(math.sin(yaw), 0, math.cos(yaw))
        root.CFrame = CFrame.lookAt(pos, pos + dir)
    end
end

-----------------------------------------------------------------
--helper graphic
-----------------------------------------------------------------
local function SetLowGraphics()
    local Lighting = game:GetService("Lighting")
    local Terrain = workspace:FindFirstChildOfClass("Terrain")
    local MaterialService = game:GetService("MaterialService")
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
    Lighting.GlobalShadows = false
    Lighting.Brightness = 1
    Lighting.EnvironmentDiffuseScale = 0
    Lighting.EnvironmentSpecularScale = 0
    for _, effect in ipairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect.Enabled = false
        end
    end
    if Terrain then
        Terrain.WaterWaveSize = 0
        Terrain.WaterWaveSpeed = 0
        Terrain.WaterReflectance = 0
        Terrain.WaterTransparency = 1
    end
    MaterialService.Use2022Materials = false
end
local renderEnabled = true
local uiHidden = false

local function toggle3DAndUI()
    renderEnabled = not renderEnabled
    uiHidden = not uiHidden
    if renderEnabled == true then
        --setfpscap(2)
        mainFrame.BackgroundTransparency = 1
    else
         --setfpscap(15)
         mainFrame.BackgroundTransparency = 0
    end
    RunService:Set3dRenderingEnabled(renderEnabled)
    
    for _, gui in ipairs(gui:GetChildren()) do
        if gui:IsA("ScreenGui") and gui ~= screenGui then
            gui.Enabled = false -- kalau render off, UI juga ikut mati
        end
    end
    
end

-----------------------------------------------------------------
--              JSON ONLINE DECODER
-----------------------------------------------------------------

local function getJSON(url)
    local response = request({
        Url = url,
        Method = "GET",
        Headers = {
            ["Accept"] = "application/json"
        }
    })

    if not response.Success then
        warn("Request gagal:", response.StatusCode)
        return nil
    end


    local ok, data = pcall(function()
        return HttpService:JSONDecode(response.Body)
    end)

    if ok then
        return data
    else
        warn("Gagal decode JSON:", data)
        return nil
    end
end

-- contoh pemakaian

local last_json_data = nil
local function ambilData()
    for i = 1, 3 do
        local success, result = pcall(function()
            return getJSON(url)
        end)
        if success and result then
            last_json_data = result
            return result
        else
            warn(("Percobaan %d gagal"):format(i))
            task.wait(1)
        end
    end
    warn("Semua percobaan gagal, pakai data lama.")
    return last_json_data
end
local json = ambilData()
if json then
    print("JSON:", json)
else
    warn("Tidak ada data sama sekali (belum pernah berhasil ambil).")
end
local config_auto_running = json.auto_running
local config_select_island = json.selected_island

if config_auto_running == false then
    text_ikan.Text = "AUTO RUN STOP" 
    running = false
end
local function getOnlineTime()
    local elapsed = tick() - startscript
    return elapsed
end

local function formatTime(seconds)
    local h = math.floor(seconds / 3600)
    local m = math.floor((seconds % 3600) / 60)
    local s = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", h, m, s)
end

local function update_inventory()
    local Client = Replion.Client
    local replion_data = Client:WaitReplion("Data")
    local inventory = replion_data:GetExpect({"Inventory"})
    print("update inventory")
    local total_harga_secret = 0
    local total_harga_mythic = 0
    local listing = 1
    list_secret = {}
    list_display = {}
    list_mythic = {}
    list_trade = {}
    for category, items in pairs(inventory) do
        if category == "Fishing Rods" then
            for _, item in ipairs(items) do
             local rod_info = list_rod[item.Id]
                if rod_info then
                    list_inventory_rod[rod_info.nama] = {
                        Id = item.Id,
                        UUID = item.UUID,
                        Name = rod_info.nama,
                        Tier = rod_info.tier
                    }
                end
            end
        end
        if category == "Items" then
            for i, item in ipairs(items) do
                if list_ikan[item.Id] then
                    local berat = item.Metadata and item.Metadata.Weight or 0
                    local nama = list_ikan[item.Id].nama
                    local uuid = item.UUID
                    if list_ikan[item.Id].tier == 7 then -- total ikan secret
                        table.insert(list_secret, uuid)
                        total_harga_secret = total_harga_secret + list_ikan[item.Id].harga
                        local text_sec = "[ " .. listing .. " ] " ..nama .. " - " .. berat .. " Kg" 
                        table.insert(list_display, text_sec)
                        listing = listing + 1
                    end
                    if list_ikan[item.Id].tier == 6 then --total ikan mythic
                        table.insert(list_mythic, uuid)
                        total_harga_mythic = total_harga_mythic + list_ikan[item.Id].harga
                    end
                    if list_ikan[item.Id].tier == 7 then -- LIST TRADE
                        
                        table.insert(list_trade, uuid)
                    end
                end
                list_inventory_fishs[item.Id] = {
                    Id = item.Id,
                    UUID = item.UUID
                }
            end
        end
    end
    if list_trade == nil then
        print("TIDAK ADA ITEM TRADEABLE")
    end
    total_secret.Text = "$ " .. konvert_harga(total_harga_secret)
   print("Total Secret:", #list_secret)
    total_mythic.Text = "$ " .. konvert_harga(total_harga_mythic)
	print("Total Mythic:", #list_mythic)
end

closeBtn.MouseButton1Click:Connect(
    function()
        spawning = false
        running = false
        screenGui:Destroy()
    end
)

btn_stop.MouseButton1Click:Connect(
    function()
        btn_stop.Text = "⏸️"
        spawning = false
        running = false
    end
)

render_btn.MouseButton1Click:Connect(
    function()
       toggle3DAndUI()
    end
)

btn_reload.MouseButton1Click:Connect(
    function()
        rejoinSameServer()
    end
)

local completed = false

-- sambungkan listener
Net:WaitForChild("RE/TextNotification").OnClientEvent:Connect(function(data)
    if data and data.Text == "Trade completed!" then
        completed = true
    end
end)

btn_trade.MouseButton1Click:Connect(
    function()
        update_inventory()
        running  = false
        print("RUNNING ", running)
        text_quest.Text = "trading di mulai..."
        --local targetName = "hayfish96"
        local berhasil = 0
        local info_akhir = ""
        local targetName = master_user
        local function trade_user(usr)
            if usr.Name == targetName then
                print("Player ditemukan:", usr.Name, "UserId:", usr.UserId)
                if list_trade ~= nil then
                    for i, uuid in ipairs(list_trade) do
                        Net:WaitForChild("RE/EquipItem"):FireServer(uuid, "Fishes")
                        Net:WaitForChild("RF/InitiateTrade"):InvokeServer(usr.UserId, uuid)
                        local timeout = 0
                        while completed ~= true do
                            print("wait")
                            timeout = timeout + 1
                            if timeout > 30 then
                                print("timeout lebih dari 15 detik")
                                break
                            end
                            task.wait(0.2)
                        end
                        if timeout < 30 then
                            berhasil = berhasil + 1
                        end
                        completed = false
                        info_akhir = "TRADE " .. berhasil .. "/" .. #list_trade
                        text_ikan.Text = info_akhir
                        task.wait(1)
                    end
                else
                    text_quest.Text = "tidak ada barang lagi"
                end
                text_quest.Text = "SELESAI SEMUA " .. info_akhir
                print("clear list")
                running  = true
            end
        end
        local existing = Players:FindFirstChild(targetName)
        if existing then
            trade_user(existing)
        else
            text_quest.Text = "player tidak ada"
        end
    end
)

local function best_rod_wear()
    local old_tier = 0
    local current_uuid = ""
    local best = nil
    for name, v in pairs(list_inventory_rod) do
        print(v.Name)
        if v.Tier > old_tier then
            old_tier = v.Tier
            current_uuid = v.UUID
            best = v.Name
        end
    end
    if current_uuid ~= "" then
        print(best)
        Net:WaitForChild("RE/EquipItem"):FireServer(current_uuid, "Fishing Rods")
        return best
    else
        print("⚠️ Tidak ada rod ditemukan.")
    end
end
local numbers = {}
local function teleport_string(data)
    for value in string.gmatch(data, "[-%d%.]+") do
        table.insert(numbers, tonumber(value))
    end
    return numbers[1], numbers[2], numbers[3], numbers[4]
end
local function quest_deep_sea(index)
    local path = workspace["!!! MENU RINGS"]["Deep Sea Tracker"].Board.Gui.Content
    local label = path:FindFirstChild("Label" .. index)
    if label and label:IsA("TextLabel") then
        return label.Text
    else
        return nil
    end
end
local function quest_jungle(index)
    local path = workspace["!!! MENU RINGS"]["Element Tracker"].Board.Gui.Content
    local label = path:FindFirstChild("Label" .. index)
    if label and label:IsA("TextLabel") then
        return label.Text
    else
        return nil
    end
end

local function update_quest()
    print("update quest di panggil -> ")
    text_lokasi.Text = player:GetAttribute("LocationName")
    text_coin.Text = koin
    print("quest:", select_quest)
    if select_quest == "jungle" then
        progress_quest1 = cek_quest(quest_jungle(1))
        progress_quest2 = cek_quest(quest_jungle(2))
        progress_quest3 = cek_quest(quest_jungle(3))
        progress_quest4 = cek_quest(quest_jungle(4))
    elseif select_quest == "deep_sea" then
        progress_quest1 = cek_quest(quest_deep_sea(1))
        progress_quest2 = cek_quest(quest_deep_sea(2))
        progress_quest3 = cek_quest(quest_deep_sea(3))
        progress_quest4 = cek_quest(quest_deep_sea(4))
    end
    text_quest_1.Text = "QUEST 1 -> " .. progress_quest1 .. " %"
    text_quest_2.Text = "QUEST 2 -> " .. progress_quest2 .. " %"
    text_quest_3.Text = "QUEST 3 -> " .. progress_quest3 .. " %"
    text_quest_4.Text = "QUEST 4 -> " .. progress_quest4 .. " %"
end
local function auto_fish()
    math.randomseed(os.time())
    local random_number = math.random() * 2 - 1
    task.wait(0.2)
    Net:WaitForChild("RF/ChargeFishingRod"):InvokeServer(tick())
    task.wait(0.5)
    Net:WaitForChild("RF/RequestFishingMinigameStarted"):InvokeServer(random_number, 1.0)
    for i = 1, 15 do
        if fish_caught == true then
            break
        end
        Net:WaitForChild("RE/FishingCompleted"):FireServer()
        task.wait(0.3)
    end
    fish_caught = false
    count_mancing = count_mancing + 1
end

local function auto_buy()
    print("start auto buy")
    local koins = convert(koin)
    if list_inventory_rod["Midnight Rod"] == nil and koins > 50000 then
        print("beli rod midnight")
        auto_buy_bait(3) -- corrupt
        auto_buy_rod(80) -- midnight rod
    end
    if list_inventory_rod["Astral Rod"] == nil and koins > 1150000 then
        print("beli rod astral")
        auto_buy_bait(15) -- corrupt
        auto_buy_rod(5) -- astral rod
    end
    if list_inventory_rod["Ghostfinn Rod"] ~= nil and koins > 4000000 then
        auto_buy_bait(20)
    end
end
local function updateList()
for _, child in pairs(listContainer:GetChildren()) do
		if child:IsA("TextLabel") then
			child:Destroy()
		end
	end

	for i, text in ipairs(list_display) do
		local label = Instance.new("TextLabel")
		label.Name = "Item_" .. i
		label.Size = UDim2.new(1, -10, 0, 25)
		label.BackgroundColor3 = Color3.fromRGB(27, 27, 27)
        label.BackgroundTransparency = 1
		label.TextColor3 = Color3.fromRGB(163, 163, 163)
		label.Font = Enum.Font.Roboto
		label.TextSize = 22
		label.Text = text
		label.TextXAlignment = Enum.TextXAlignment.Left
		label.Parent = listContainer
	end
end

task.spawn(
    function()
        local num = 1
        local flag_error = false
        while spawning or running do
            local currentTime = os.clock()
            text_jam.Text = formatTime(math.floor(getOnlineTime()))
            if lastCatchTime then
                local delta = currentTime - lastCatchTime
                delta = math.floor(delta * 10 + 0.5) / 10
                if delta < 30 then
                    flag_error = false
                    text_timer.Text = "⏳" .. delta .. " sec."
                else
                    flag_error = true
                    mainFrame.BackgroundColor3 = Color3.fromRGB(197, 16, 16)
                    text_timer.Text = "⚠️ OVER ⚠️ " .. delta .. " sec."
                end
                if delta > 120 then
                    rejoinSameServer()
                    task.wait(60)
                end
            end
            if num % 300 == 0 then -- tiap 5 menit
                update_inventory()
                Net:WaitForChild("RE/EquipToolFromHotbar"):FireServer(1)
                mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                task.wait(2)
                Net:WaitForChild("RF/SellAllItems"):InvokeServer(now)
                task.wait(2)
                update_quest()
                updateList()
            end
            if num % 30 == 0 then -- tiap 30 detik
                if flag_error == true then
                    task.wait(0.5)
                    Net:WaitForChild("RF/CancelFishingInputs"):InvokeServer(tick())
                    task.wait(0.5)
                    Net:WaitForChild("RE/FishingCompleted"):FireServer()
                    task.wait(0.5)
                    mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                end

                 
            end
            text_total.Text = count_mancing
            num = num + 1
            task.wait(2)
        end
    end
)


----------------------------------------------------------------------------------------------------------------------------
---
---MULAI ALGORITMA
---
--discord("online")
SetLowGraphics()
toggle3DAndUI()
print("INISIALISASI --------------------------")
update_inventory()
auto_buy()
local current_rod = best_rod_wear()

text_rod.Text = current_rod
if current_rod == "Ghostfinn Rod" then
    select_quest = "jungle"
else
    select_quest = "deep_sea"
end
print(select_quest)


update_quest()

updateList()

text_quest_master.Text = select_quest .. " Quest :"

Net:WaitForChild("RE/EquipToolFromHotbar"):FireServer(1)

progress_quest1 = 100
print("MAIN PROGRAM -------------------------------")

if select_quest == "deep_sea" then
    print(progress_quest1)
    print(progress_quest2)
    print(progress_quest3)
    print(progress_quest4)
    if progress_quest1 < 100 then
        print("deep sea progress 1")
        text_quest.Text = quest_deep_sea(1)
        teleport(-3602, -283, -1612)
        task.wait(3)
        face(120)
        while progress_quest1 < 100 do
            auto_fish()
            if not running then break end
        end
    end
    if ((progress_quest2 + progress_quest3 + progress_quest4)/3) < 100 then
        print("deep sea progress 2")
        text_quest.Text = quest_deep_sea(2)
        teleport(-3734, -135, -1013)
        task.wait(3)
        face(0)
        while ((progress_quest2 + progress_quest3 + progress_quest4)/3) < 100 do
            auto_fish()
            if not running then break end
        end
    end
    print("done deep sea")
    text_quest.Text = "selesai deep sea quest"
    best_rod_wear()
    select_quest = "jungle"
end
if select_quest == "jungle" then

    local exists = workspace["JUNGLE INTERACTIONS"].Doors.TempleDoor:FindFirstChild("DELETE_ME_AFTER_UNLOCK")

    if exists then
        print("Model ditemukan!")
        step = 1
    else
        step = 3
    end

    while running do
        if step == 0 then
            break
        end
        if step == 1 then
            if running and list_inventory_fishs[265] == nil then
                text_quest.Text = "1 > Arrow artefak"
                x, y, z, arah = teleport_string(json.quest.jungle.arrow)
                teleport(x, y, z)
                task.wait(5)
                face(arah)
                while list_inventory_fishs[265] == nil do
                    auto_fish()
                    if not running then break end
                end
            end
            if running and list_inventory_fishs[266] == nil then
                text_quest.Text = "2 > crescent artefak"
                x, y, z, arah = teleport_string(json.quest.jungle.crescent)
                teleport(x, y, z)
                task.wait(5)
                face(arah)
                while list_inventory_fishs[266] == nil do
                    auto_fish()
                    if not running then break end
                end
            end
            if running and list_inventory_fishs[267] == nil then
                text_quest.Text = "3 > diamond artefak"
                x, y, z, arah = teleport_string(json.quest.jungle.diamond)
                teleport(x, y, z)
                task.wait(5)
                face(arah)
                while list_inventory_fishs[267] == nil do
                    auto_fish()
                    if not running then break end
                end
            end
            if running and list_inventory_fishs[271] == nil then
                text_quest.Text = "4 > hourglass artefak"
                x, y, z, arah = teleport_string(json.quest.jungle.hourglass)
                teleport(x, y, z)
                task.wait(5)
                face(arah)
                while list_inventory_fishs[271] == nil do
                    auto_fish()
                    if not running then break end
                end
            end
            if list_inventory_fishs[265] ~= nil and list_inventory_fishs[266] ~= nil and list_inventory_fishs[267] ~= nil and list_inventory_fishs[271] ~= nil then
                print("selesai step 1")
                text_quest.Text ="selesai step 1"
                step = step + 1
            end
        end

        if step == 2 then
            discord("sudah sampai step 2")
            text_quest.Text ="STEP 2 !!"
            list_quest_id = {265,266,267,271}
            for i, k in ipairs(list_quest_id) do
                if list_inventory_fishs[k] ~= nil then
                    if i == 1 then
                        teleport(897, 8, -361)
                        task.wait(5)
                    end
                     if i == 2 then
                        teleport(1420, 31, 79)
                        task.wait(5)
                    end
                     if i == 3 then
                        teleport(1819, 8, -284)
                        task.wait(5)
                    end
                     if i == 4 then
                        teleport(1485, 8, -861)
                        task.wait(5)
                    end
                    Net:WaitForChild("RE/EquipItem"):FireServer(list_inventory_fishs[k].UUID, "Fishes")
                    task.wait(1)
                    Net:WaitForChild("RE/PlaceLeverItem"):FireServer(list_ikan[k].nama)
                    task.wait(1)
                end
            end
             
            while true do
                local pintu = workspace["JUNGLE INTERACTIONS"].Doors.TempleDoor:FindFirstChild("DELETE_ME_AFTER_UNLOCK")
                if pintu then
                    print("menunggu")
                    text_quest.Text ="menunggu pintu terbuka"
                else
                    break
                end
                task.wait(20)
            end
            text_quest.Text ="WAITING REJOIN GAME !!"
            step = step + 1
            rejoinSameServer()
            task.wait(60)
            break
        end

        if step == 3 then
            text_quest.Text ="STEP 3 !!"
            if running and progress_quest3 < 100 then 
                text_quest.Text = quest_jungle(3) -- Catch 1 SECRET fish at Sacred Temple - 0%
                teleport(1510, -22, -629)
                task.wait(3)
                face(0)
                while progress_quest3 < 100 do
                    auto_fish()
                    if not running then break end
                end
            end
            if running and progress_quest2 < 100 then
                text_quest.Text = quest_jungle(2) -- Catch 1 SECRET fish at Ancient Jungle - 0%
                teleport(878, 4, -351)
                task.wait(3)
                face(0)
                while progress_quest2 < 100 do
                    auto_fish()
                    if not running then break end
                end
            end
            if running and progress_quest4 < 100 then
                -- manual goto altar and give secret 3
                teleport(1487, 128, -591)
                text_quest.Text = "MANUAL ENCHANGED"
                break
            end
        end
        text_rod.Text = "waiting running..."
        task.wait(10)
    end

end
spawning = false
running = false
root.Anchored = false
print("running : ", running)
print("-----------------end-------------")
--]]
-----------------------------------------------------------------
--               E N D     M A I N
-----------------------------------------------------------------
